var grsHmTouchEvents=angular.module("grsHmTouchEvents",[]),grsHmGestures=["hmHold:hold","hmTap:tap","hmDoubletap:doubletap","hmDrag:drag","hmDragstart:dragstart","hmDragend:dragend","hmDragup:dragup","hmDragdown:dragdown","hmDragleft:dragleft","hmDragright:dragright","hmSwipe:swipe","hmSwipeup:swipeup","hmSwipedown:swipedown","hmSwipeleft:swipeleft","hmSwiperight:swiperight","hmTransformstart:transformstart","hmTransform:transform","hmTransformend:transformend","hmRotate:rotate","hmPinch:pinch","hmPinchin:pinchin","hmPinchout:pinchout","hmTouch:touch","hmRelease:release"];angular.forEach(grsHmGestures,function(e){var e=e.split(":"),r=e[0],o=e[1];grsHmTouchEvents.directive(r,["$parse",function(n){return{scope:!0,link:function(t,e,a){var i=n(a[r]),a=n(a.hmOptions)(t,{});return a&&a.group?t.hammer=t.hammer||Hammer(e[0],a):t.hammer=Hammer(e[0],a),t.hammer.on(o,function(e){return t.$apply(function(){return i(t,{$event:e})})})}}}])});var html=document.getElementsByTagName("html")[0],grsApp=angular.module("grsApp",["grsHmTouchEvents"]).config(["$locationProvider",function(e){e.hashPrefix("!")}]);function insertCss(e,t){var a=document.head,i=document.createElement("link");"0"!==e.theme&&(i.grs=t,i.type="text/css",i.rel="stylesheet",i.href=scriptData.grsPluginUrl+"/css/grsTemplate"+e.theme+".css?lastmodified="+e.themeLastModDate,a.appendChild(i),i.onload=function(){var e=document.querySelector("#grsGal"+this.grs+" > div"),e=angular.element(e).scope();e.params.cssReady=!0,e.$$phase||e.$apply()})}angular.element(document).ready(function(){jQuery(".woocommerce").attr("ng-non-bindable","");var e=document.createElement("div"),t=document.createElement("grs-popup");e.setAttribute("ng-controller","grsPopupC"),t.setAttribute("resize","resize"),e.appendChild(t),document.body.appendChild(e),angular.bootstrap(html,["grsApp"])}),grsApp.directive("imageOnload",["GrsService",function(e){return{restrict:"A",link:function(e,t,a){t.bind("load",function(){e.$apply(a.imageOnload)})}}}]),grsApp.directive("backImg",["GrsService",function(i){return{restrict:"A",scope:!0,link:function(e,t,a){a=a.backImg;i.log(a),a=a.replace(/'/g,"\\'"),t.css({"background-image":"url('"+a+"')"})}}}]),grsApp.directive("ifrSrc",["GrsService",function(e){return{restrict:"A",scope:!0,link:function(e,t,a){a=(a=a.ifrSrc).replace(/'/g,"\\'");t.attr("src",a)}}}]),grsApp.directive("vgSrc",["GrsService",function(e){return{restrict:"A",scope:!0,link:function(e,t,a){a=(a=a.vgSrc).replace(/'/g,"\\'");t.attr("src",a)}}}]),grsApp.directive("resize",["$window","GrsService",function(a,e){return{link:function(t){function e(e){t.$broadcast("resize::resize")}angular.element(a).on("resize",e),t.$on("$destroy",function(){angular.element(a).off("resize",e)})}}}]),grsApp.directive("scroll",["$window","GrsService",function(a,e){return{link:function(t){function e(e){t.$broadcast("scroll::scroll",5022)}angular.element(a).on("scroll",e),t.$on("$destroy",function(){angular.element(a).off("scroll",e)})}}}]),grsApp.directive("postComm",["GrsService",function(e){return function(t,e,a){e.bind("keydown keypress",function(e){13===e.which&&e.shiftKey||13===e.which&&(e.preventDefault(),t.$apply(function(){t.postIc()}))})}}]),grsApp.service("GrsService",["$log","$window","$sce",function(t,a,i){this.mode="pro",this.isPremium=scriptData.grsIsPremium,this.plan=scriptData.grsPlanName,this.wpUploaderUrl=scriptData.grsWpUploaderUrl,this.uploaderUrl=scriptData.grsUploaderUrl,this.shareUrl=scriptData.grsShareUrl,this.pluginUrl=scriptData.grsPluginUrl,this.pluginVer=scriptData.grsPluginVer,this.imagesDir=this.pluginUrl+"/images/",this.settings={},this.settingsReady=!1,this.effectsJsonUrl=i.trustAsResourceUrl(this.pluginUrl+"/frontend/views/grsEffects.json?ver="+this.pluginVer),this.getViewsTemplateUrl=function(e){return i.trustAsResourceUrl(this.pluginUrl+"/frontend/views/"+e+".html?ver="+this.pluginVer)},this.isProPlan=function(){return"pro"===this.plan},this.isPersonalPlan=function(){return"personal"===this.plan},this.isElitePlan=function(){return"elite"===this.plan},this.isFreePlan=function(){return"free"===this.plan},this.popup={grs:0,show:!1,shatts:{},theme:{},first:!0,items:[],pI:[],cP:0,pC:0,tC:0,lC:0,index:0},this.setPopObj=function(e){if(this.popup.grs=e.grs,this.popup.gallId=e.gallId,this.popup.shatts=e.shatts,this.popup.theme=e.theme,this.popup.orderby=e.orderby,this.popup.ordering=e.ordering,this.popup.items=e.items,this.popup.cP=e.cP,this.popup.pC=e.pC,this.popup.tC=e.tC,this.popup.lC=e.lC,this.popup.index=e.index,0!=e.pC)for(var t=0;t<e.pC;t++)void 0!==e.pI[t]&&(this.popup.pI[t]=e.pI[t]);else this.popup.pI=[];this.log(e),this.popup.show=angular.copy(e.show)},this.setSettings=function(e){this.settings.collapseNavClicks=parseInt(e.collapseNavClicks),this.settings.fmImMoveCount=parseInt(e.fmImMoveCount),this.settings.filmImMoveCount=parseInt(e.filmImMoveCount),this.settings.showVmTitle=parseInt(e.showVmTitle),this.settings.showYtTitle=parseInt(e.showYtTitle),this.settings.hideNavButton=parseInt(e.hideNavButton),this.settings.closeLbOnSide=parseInt(e.closeLbOnSide),this.settings.openCommTrig=parseInt(e.openCommTrig),this.settings.showTitleDescTrig=parseInt(e.showTitleDescTrig),this.settings.default=parseInt(e.default),this.settings.clicksCount=parseInt(e.clicksCount)},this.grsShTC=function(e,t){return"always"===e||"onhover"===e&&"mask"!==t},this.grsShMC=function(e,t){return"mask"===t&&"onhover"===e},this.grsOnhv=function(e){return"onhover"===e},this.log=function(e){"dev"===this.mode&&t.log(e)},this.getImageVer=function(e,t,a){a="thumbnail"===a?2:1;return e=parseInt(e),t=parseInt(t),e<=400/a&&t<=400/a?"thumbnail/":e<=800/a&&t<=800/a?"medium/":e<=1500/a&&t<=1500/a?"large/":e<=2e3/a&&t<=2e3/a?"extralarge/":""},this.getImageSource=function(e,t){return this["itemSource_"+e.embed](e,t)},this.itemSource_=function(e,t){t=this.getImageVer(e.thumbWidth,e.thumbHeight,t);return this.uploaderUrl+e.path+t+e.name+e.type},this.itemSource_instagram=function(e,t){var a=parseInt(e.thumbWidth),i=parseInt(e.thumbHeight),t="thumbnail"===t?2:1;return"video"===e.type||a<=300/t&&i<=300/t?e.thumb_url:e.path},this.itemSource_youtube=function(e){return e.thumb_url},this.itemSource_vimeo=function(e){return e.thumb_url},this.itemSource_flickr=function(e,t){var a=parseInt(e.thumbWidth),i=parseInt(e.thumbHeight),t="thumbnail"===t?2:1;return a<=400/t&&i<=400/t?e.thumb_url:e.path},this.itemSource_wp=function(e,t){var a=this.getWPImageSizes(e);return this.wpUploaderUrl+e.path+e.name+this.getImageVerWp(parseInt(e.thumbWidth),parseInt(e.thumbHeight),a,t)+e.type},this.getWPImageSizes=function(e){var t=parseInt(e.width),a=parseInt(e.height),i=e.wp_sizes;if(null===i)return{medium:300<t||300<a?this.getRightSizeUrlForWp(300,t,a):"",large:1024<t||1024<a?this.getRightSizeUrlForWp(1024,t,a):"",full:""};e.wp_sizes="object"!=typeof i?JSON.parse(i):i;e=void 0!==(i=e.wp_sizes).large?"-"+i.large.width+"x"+i.large.height:"";return{medium:void 0!==i.medium?"-"+i.medium.width+"x"+i.medium.height:e,large:e,full:""}},this.getImageVerWp=function(e,t,a,i){i="thumbnail"===i?2:1;return e<=400/i&&t<=400/i?a.medium:e<=800/i&&t<=800/i?a.large:a.full},this.getLightboxWPimageSize=function(e,t,a,i){e=this.getWPImageSizes(e);return this.getImageVerWp(parseInt(t),parseInt(a),e,i)},this.getRightSizeUrlForWp=function(e,t,a){return a<t?"-"+e+"x"+Math.round(e*a/t):"-"+Math.round(e*t/a)+"x"+e},this.shVIc=function(e){e=e.type;return"video"===e||"link"===e},this.link=function(e,t){a.open(this["link_"+e.embed](e),t)},this.link_=function(e){return""===e.link?this.uploaderUrl+e.path+e.name+e.type:e.link},this.link_wp=function(e){return""===e.link?this.wpUploaderUrl+e.path+e.name+e.type:e.link},this.link_youtube=function(e){return""===e.link?e.path:e.link},this.link_instagram=function(e){return this.link_youtube(e)},this.link_flickr=function(e){return this.link_youtube(e)},this.link_vimeo=function(e){return this.link_youtube(e)},this.toUpperCaseFl=function(e){return e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})},this.getWidthHeightForFmResize=function(e,t,a){var i={};return a<t?(i.height=Math.round(e/Math.round(t/a)),i.width=e):(i.width=Math.round(e/Math.round(a/t)),i.height=e),i},this.getTrans=function(e){return void 0!==frontTransObj[e]?frontTransObj[e]:e}}]),grsApp.controller("grsPopupC",["$scope","$filter","$log","GrsService","GrsFactory",function(e,t,a,i,n){n.getSettings().then(function(e){angular.isUndefined(e.data.success)?i.log("Error , try to get settings."):(i.setSettings(e.data.success),i.settingsReady=!0)},function(e){i.log(e)})}]),grsApp.directive("grsPopup",["$filter","GrsFactory","GrsService","$window","$timeout","$location",function(e,g,c,o,i,n){return{restrict:"E",transclude:!0,scope:!1,templateUrl:c.getViewsTemplateUrl("grsPopup"),link:function(C,e,t){var a;C.options={show:c.popup.show},C.options.enterPopup=function(){return c.log(1111111114444),c.log(C.options.show),c.log(4444444441111),c.log(C.options.effectsLoaded),C.options.show&&C.options.effectsLoaded},C.options.showPopup=function(){return C.view.ready=C.options.commContloaded&&C.options.filmContLoaded,C.view.ready},C.params={grs:0,gallId:c.popup.gallId,shatts:c.popup.shatts,theme:c.popup.theme},C.psImg={},c.isPremium?g.getEffects().then(function(e){C.grsEffects=e.data,C.options.show&&C.setEffect(C.params.shatts.lightboxeffect),C.options.effectsLoaded=!0,C.$$phase||C.$apply()},function(e){c.log(e)}):((a={noEffect:{}}).noEffect.effects={},a.noEffect.effects.no={},a.noEffect.doEffect="grsNoEffect",a.noCutting={},a.noCutting.effects={},a.noCutting.effects.fade={},a.noCutting.effects.fade.in="grsFadeIn grsAnDur inAnimationEnd",a.noCutting.effects.fade.out="grsFadeOut grsAnDur outAnimationEnd",a.noCutting.doEffect="grsNoCuting",C.grsEffects=a,C.options.effectsLoaded=!0),C.view={cImIn:0,effect:{},mainAnimationEnd:!0,cImInG:-1,grsCC:[],isFS:!1,shInf:!0,enAp:!1,isFSSmart:!1,active:"",actImg:"",captcha:"",comments:{},isOCC:!0,contButtOp:!0,filmView:c.getViewsTemplateUrl("grsFilmstrip"),commView:c.getViewsTemplateUrl("grsComments")},C.effectsTiming={msForEff:["550","570","590","520","550","870","890","810","830","850","1070","1090","1010","1030","1050","1270","1290","1210","1230","1250","1470","1490","1410","1430","1550","1570","1570","1570","1570","1570","1570","1570","1570","1570","1570","1570","1570","1570"],msForEffHor:["500","600","700","800","900","1000","1100","1200","1300","1400","1500","1600"]},C.browser={pfx:["webkit","moz","ms","o",""],name:""},C.checkBrowser=function(){var e,t=navigator.userAgent;-1!=t.indexOf("Firefox")?C.browser.name="Firefox":-1!=t.indexOf("OPR")?C.browser.name="Opera":-1!=t.indexOf("Edge")?C.browser.name="Edge":-1!=t.indexOf("Safari")?(e=/Google Inc/.test(navigator.vendor),t=/Apple Computer/.test(navigator.vendor),e?C.browser.name="Chrome":t&&(C.browser.name="Safari")):C.browser.name="Explorer"},C.checkBrowser(),C.items=[],C.$watch(function(){return c.popup.show},function(e,t){c.log(321321),C.options.show=e,C.params.grs=c.popup.grs,C.params.gallId=c.popup.gallId,C.params.shatts=c.popup.shatts,C.params.theme=c.popup.theme,C.params.orderby=c.popup.orderby,C.params.ordering=c.popup.ordering,C.items=c.popup.items,C.view.pI=c.popup.pI,C.view.cP=c.popup.cP,C.view.pC=c.popup.pC,C.view.tC=c.popup.tC,C.view.lC=c.popup.lC,C.view.cImIn=c.popup.index,C.view.noEffect="no"===C.params.shatts.lightboxeffect,C.view.mainAnimationEnd=!0,C.view.loading=!1,C.view.cloading=!1,C.view.outAnimationEnd=!0,C.view.inAnimationEnd=!0,C.view.active="",C.view.actImg="",C.view.grsCC=[],C.view.comments={},C.view.isOCC="1"===C.params.shatts.lightboxcomment&&c.settings.openCommTrig,C.view.emptyName=!1,C.view.invalidMail=!1,C.view.emptyComment=!1,C.view.emptyCaptcha=!1,C.view.contButtOp=!0,C.view.isFSSmart=!1,C.view.actImgId=0,C.view.isFS=!1,C.view.ready=!1,C.view.shInf=c.settings.showTitleDescTrig,C.view.enAp=!1,C.view.apInt=1e3*parseInt(C.params.shatts.lightboxapin),C.options.commContloaded=!((c.isProPlan()||c.isElitePlan())&&"1"===C.params.shatts.lightboxcomment),C.options.filmContLoaded=!(c.isPremium&&"1"===C.params.shatts.lightboxfilmstrip);e=angular.isString(C.view.cImIn)&&-1!==C.view.cImIn.indexOf("hash-")?C.view.cImIn:c.popup.cP*C.params.shatts.imagesperpage+C.view.cImIn;if(angular.isUndefined(C.view.cachCmmAct)||delete C.view.cachCmmAct,!C.options.show)return delete C.view.firstIn,C.view.cImInG=-1,void(C.view.setAutoplay&&i.cancel(C.view.setAutoplay));C.setViewParamsByRes(),C.setEffect(C.params.shatts.lightboxeffect),C.setItem(e),C.getItems(e)},!0),C.$watch("view.ready",function(){C.view.ready&&C.options.show&&jQuery("html, body").addClass("grsPopupParents")},!0),C.getItems=function(r){var o=[];if("numbers"===C.params.shatts.pagination)for(var e,t=0;t<C.view.pC;t++)angular.isUndefined(C.view.pI[t])&&(e={from:t,count:C.params.shatts.imagesperpage},o.push(e));else C.view.pI[0].length!=C.view.tC&&(e={from:C.view.lC,count:C.params.shatts.imagesperpage*(C.view.pC-C.view.lC)},o.push(e));if(0<o.length)g.getPopupData(C.params.gallId,o,C.params.shatts.imagesperpage,C.params.orderby,C.params.ordering).then(function(e){if(void 0!==e.data.success){var t=e.data.success;if("numbers"==C.params.shatts.pagination)for(var a=0;a<o.length;a++){C.view.pI[o[a].from]=[];for(var i=0;i<o[a].count;i++)void 0!==t[o[a].count*a+i]&&(C.view.pI[o[a].from][i]=t[o[a].count*a+i])}else C.view.pI[0]=C.view.pI[0].concat(t);for(var n=0;n<C.view.pI.length;n++)C.items=C.items.concat(C.view.pI[n])}else c.log("Error , something went wrong.");C.checkForgrsHash()||C.setFW(r)},function(e){c.log(e)});else{c.log("Images already loaded");for(var a=0;a<C.view.pI.length;a++)C.items=C.items.concat(C.view.pI[a]);C.checkForgrsHash()||C.setFW(r)}},C.checkForgrsHash=function(){if(angular.isString(C.view.cImInG)&&-1!=C.view.cImInG.indexOf("hash-")){for(var e=C.view.cImInG.split("hash-")[1],t=!1,a=-1,i=0;i<C.items.length;i++)if(C.items[i].id==e){a=i,t=!0;break}return t?(C.setItem(a,!0),C.setFW(a)):(C.grsCp(),c.log("chkar")),!0}return!1},C.setViewParamsByRes=function(){C.$broadcast("resize::resize")},C.setFW=function(e){C.view.fcw=C.items.length*(C.view.ftw+C.view.ftm+2*(C.view.ftp+C.view.ftbw))+C.view.ftm,C.moveFC("fromImgNav",e)},C.shFilmsVtop=function(){return!("1"!==C.params.shatts.lightboxfilmstrip||!c.isPremium)&&"top"===C.params.theme.filmstripPos},C.shFilmsVbot=function(){return!("1"!==C.params.shatts.lightboxfilmstrip||!c.isPremium)&&"bottom"===C.params.theme.filmstripPos},C.shCbutts=function(){return"1"===C.params.shatts.lightboxcontbutts},C.contButtPos=function(){return C.sisVideo()||C.fisVideo()||C.sisLink()||C.fisLink()?"refactorContent":""},C.grsCheckLNavVis=function(){return 0===C.view.cImInG&&c.settings.hideNavButton?"grsHide":""},C.grsCheckRNavVis=function(){return C.view.cImInG===C.items.length-1&&c.settings.hideNavButton?"grsHide":""},C.shCommCont=function(){return"1"===C.params.shatts.lightboxcomment&&(c.isProPlan()||c.isElitePlan())},C.shCommContLoaded=function(){C.options.commContloaded=!0,C.$$phase||C.$apply()},C.shFilmContLoaded=function(){C.options.filmContLoaded=!0,C.$$phase||C.$apply()},C.chSwp=function(){return"1"===C.params.shatts.lightboxswipe?"grsPoin":""},C.fisImage=function(){return"video"!==C.img.type&&"link"!==C.img.type},C.sisImage=function(){return"video"!==C.psImg.type&&"link"!==C.psImg.type},C.fisVideo=function(){return"video"===C.img.type&&"first"===C.view.active},C.sisVideo=function(){return"video"===C.psImg.type&&"second"===C.view.active},C.fisLink=function(){return"link"===C.img.type&&"first"===C.view.active},C.sisLink=function(){return"link"===C.psImg.type&&"second"===C.view.active},C.fImSrc=function(){return C.getLightboxImageSource(C.img,C.view.icw,C.view.ich,"main")},C.sImSrc=function(){return C.getLightboxImageSource(C.psImg,C.view.icw,C.view.ich,"main")},C.setItem=function(e,t){C.view.cImInG=e,angular.isString(C.view.cImInG)&&-1!=C.view.cImInG.indexOf("hash-")||(C.img=void 0===t?C.view.pI[C.view.cP][C.view.cImIn]:C.items[C.view.cImInG],C.view.cImId=C.img.id,C.setLh(C.img.id),C.fillShU(C.img),C.reloadCap(),t=-1!=C.img.type.indexOf(".")?"image":C.img.type,C["setItem_"+t]())},C.getLightboxImageSource=function(e,t,a,i){if(void 0!==e.embed)return C["getLightboxImageSource_"+e.embed](e,t,a,i)},C.getLightboxImageSource_=function(e,t,a,i){return c.uploaderUrl+e.path+c.getImageVer(t,a,i)+e.name+e.type},C.getLightboxImageSource_wp=function(e,t,a,i){return c.wpUploaderUrl+e.path+e.name+c.getLightboxWPimageSize(e,t,a,i)+e.type},C.getLightboxImageSource_instagram=function(e,t,a,i){return C.getLightboxImageSource_embed(e,t,a,i)},C.getLightboxImageSource_flickr=function(e,t,a,i){return C.getLightboxImageSource_embed(e,t,a,i)},C.getLightboxImageSource_youtube=function(e,t,a,i){return"main"===i?e.path+"&showinfo="+c.settings.showYtTitle:e.thumb_url},C.getLightboxImageSource_vimeo=function(e,t,a,i){return"main"===i?e.path+"?title="+c.settings.showVmTitle:e.thumb_url},C.getLightboxImageSource_embed=function(e,t,a,i){return e["main"!==i?"thumb_url":"path"]},C.setItem_image=function(){var e=new Image,t=C.img,a=C.view;e.src=C.getLightboxImageSource(t,a.icw,a.ich,"main"),e.cImInG=a.cImInG,e.cImId=t.id,e.complete||4===e.readyState?C.setSomeViewParams(e.cImId):(a.loading=!0,e.onload=function(){var e;this.cImInG==a.cImInG?(e=this.cImId,C.setSomeViewParams(e)):c.log("not same for first ---------- "),c.log("first change loading end ---------- "),C.$apply()})},C.setItem_video=function(){C.setSomeViewParams(C.img.id)},C.setItem_link=function(){C.setItem_video()},C.setSomeViewParams=function(e){var t=C.view;t.loading=!1,t.firstIn=!0,t.active="first",t.actImg="first",t.mainAnimationEnd=!1,t.inAnimationEnd=!1,t.outAnimationEnd=!1,t.actImgId=e,C.fillICC(e)},C.setData=function(e,t,a){var i,n={},r=C.items.length,o=C.view.grsCC,s=o.length-1,g=-1<s;if(angular.isString(C.view.cImInG)&&-1!=C.view.cImInG.indexOf("hash-"))c.log("Hash not changed.");else{if("previous"==e?i=g&&!C.view.loading?0<o[s]?o[s]-1:r-1:0<C.view.cImInG?C.view.cImInG-1:r-1:"next"==e?i=g&&!C.view.loading?o[s]<r-1?o[s]+1:0:C.view.cImInG<r-1?C.view.cImInG+1:0:"other"==e?i=void 0!==t?t:0:c.log("Unknown change event"),n.imgData=C.items[i],n.cImInG=i,void 0!==n.imgData)return C.view.mainAnimationEnd||C.view.noEffect?void(i!=C.view.cImInG?C.grsChangeItem(n):c.log("Same index ------ ")):(c.log("Animation in progress ------ "),void(c.settings.collapseNavClicks&&o.length<c.settings.clicksCount?(o.push(n.cImInG),c.log(o)):c.log("Stack is full ------ ")));c.log("Images is not loaded")}},C.grsLeft=function(e){void 0!==e&&e.preventDefault();e=C.view;e.enAp&&e.setAutoplay&&i.cancel(e.setAutoplay),C.setData("previous")},C.swipeLeft=function(e){"1"==C.params.shatts.lightboxswipe&&C.grsLeft(e)},C.grsRight=function(e){var t=C.view;"boolean"!=typeof e&&t.enAp&&t.setAutoplay&&i.cancel(t.setAutoplay),void 0!==e&&"boolean"!=typeof e&&e.preventDefault(),C.setData("next")},C.swipeRight=function(e){"1"==C.params.shatts.lightboxswipe&&C.grsRight(e)},C.selectImg=function(e,t){var a=C.view;a.enAp&&a.setAutoplay&&i.cancel(a.setAutoplay),C.setData("other",e,t)},C.grsChangeItem=function(e){var t=-1!=e.imgData.type.indexOf(".")?"image":e.imgData.type;C["grsChange_"+t](e)},C.grsChange_image=function(e){var t=e.imgData,a=C.view,i=C.items[a.cImInG].id,n=new Image;if(n.src=C.getLightboxImageSource(t,a.icw,a.ich,"main"),n.img=t,n.cImInG=e.cImInG,n.cImId=t.id,a.cImInG=e.cImInG,a.cImId=t.id,C.grsDoAction(t,i),!n.complete&&4!==n.readyState)return a.grsCC=[],a.loading=!0,void(n.onload=function(){if(this.cImInG==a.cImInG)if(void 0===a.firstIn){c.log("firstIn is set after load---------- "),C.img=C.items[this.cImInG],C.psImg=C.img;var e=this.cImId;C.setSomeViewParams(e)}else{if(a.loading=!1,a.actImgId==this.cImId)return void c.log("same id , so not do effect from loaded");c.log("objImg.loaded ---------- ");C.setSomeViewParamsForChange(this.img)}else c.log("Not same <---------- ");c.log("Change loading end <---------- "),C.$apply()});if(c.log("objImg.complete ---------- "),void 0===a.firstIn)c.log("firstIn is set ---------- "),C.img=C.items[n.cImInG],C.psImg=C.img,C.setSomeViewParams(n.cImId);else{if(a.loading=!1,a.actImgId==a.cImId)return void c.log("same id , so not do effect");C.setSomeViewParamsForChange(t)}},C.setSomeViewParamsForChange=function(e){var t=C.view,a=C.params.shatts.lightboxeffect,a="video"!=e.type&&"link"!=e.type&&"video"!=C.img.type&&"link"!=C.img.type&&"video"!=C.psImg.type&&"link"!=C.psImg.type?a:"no"==a?"no":"fade";c.log("hmikva typ@ -- "+e.type),t.mainAnimationEnd=!1,t.inAnimationEnd=!1,t.outAnimationEnd=!1,C.setEffect(a),C.grsDoEffect(e),C.fillICC(e.id)},C.grsChange_video=function(e){var t=e.imgData,a=C.view,i=C.items[a.cImInG].id;a.cImInG=e.cImInG,a.cImId=t.id,C.grsDoAction(t,i),void 0===a.firstIn?(c.log("firstIn is set ---------- "),C.img=C.items[a.cImInG],C.psImg=C.img,C.setSomeViewParams(a.cImId)):(a.loading=!1,a.actImgId!=a.cImId?C.setSomeViewParamsForChange(t):c.log("same id , so not do effect"))},C.grsChange_link=function(e){C.grsChange_video(e)},C.grsDoAction=function(e,t){C.moveFC("fromImgNav",C.view.cImInG),C.changeLh(t,e.id),C.fillShU(e)},C.grsDoEffect=function(e){C.view.actImgId=e.id,C[C.view.effect.func](C.view.effect.obj,e)},C.fillShU=function(e){var t=C.params.grs,a=""===e.embed?c.uploaderUrl+e.path+"medium/"+e.name+e.type:"wp"===e.embed?c.wpUploaderUrl+e.path+e.name+c.getLightboxWPimageSize(e,1e3,1e3)+e.type:e.thumb_url;C.view.grsFacebook="https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(c.shareUrl+"&socialNetwork=facebook&imageId="+e.id+"&grs="+t+"&curUrl="+encodeURIComponent(n.absUrl())),C.view.grsTwitter="https://twitter.com/intent/tweet?url="+encodeURIComponent(c.shareUrl+"&socialNetwork=twitter&imageId="+e.id+"&grs="+t+"&curUrl="+encodeURIComponent(n.absUrl()))+"&text="+e.title,C.view.grsPinterest="https://pinterest.com/pin/create/button/?url="+encodeURIComponent(c.shareUrl+"&socialNetwork=pinterest&imageId="+e.id+"&grs="+t+"&curUrl="+encodeURIComponent(n.absUrl()))+"&media="+encodeURIComponent(a)+"&description="+e.title,C.view.grsTumblr="https://www.tumblr.com/widgets/share/tool?canonicalUrl="+encodeURIComponent(c.shareUrl+"&socialNetwork=tumblr&imageId="+e.id+"&grs="+t+"&curUrl="+encodeURIComponent(n.absUrl())),C.view.grsLinkedIn="https://www.linkedin.com/shareArticle?url="+encodeURIComponent(c.shareUrl+"&socialNetwork=linkedin&imageId="+e.id+"&grs="+t+"&curUrl="+encodeURIComponent(n.absUrl())),C.view.grsReddit="https://reddit.com/submit?url="+encodeURIComponent(c.shareUrl+"&socialNetwork=reddit&imageId="+e.id+"&grs="+t+"&curUrl="+encodeURIComponent(n.absUrl()))+"&title="+e.title},C.setLh=function(e){e=n.path()+"/id/"+e;n.path(e).replace()},C.changeLh=function(e,t){t=n.path().replace("/id/"+e,"/id/"+t);n.path(t).replace()},C.clearLh=function(){var e=n.path(),t=C.view.cImId,t=e.replace("/id/"+t,"");n.path(t).replace()},C.fillICC=function(e){var t=C.view.cImInG;-1==Object.keys(C.view.comments).indexOf(t.toString())&&(C.view.comments[t]=[],C.view.cloading=!0,g.getImgComm(e,C.params.gallId).then(function(e){C.view.cloading=!1,void 0!==e.data.success&&(C.view.comments[t]=e.data.success)},function(e){c.log(e)}))},C.postIc=function(){var a=void 0!==C.view.grsCommName?C.view.grsCommName:"",e=void 0!==C.view.grsCapCode?C.view.grsCapCode:"",i=void 0!==C.view.grsCommEmail?C.view.grsCommEmail:"",n=void 0!==C.view.grsCommText?C.view.grsCommText:"",r=C.view.cImId,o=C.params.gallId,s=C.view.cImInG;return c.log("gallid"+o),""===a?(C.view.emptyName=!0,void c.log("Name empty")):C.validateEmail(i)?""==n?(C.view.emptyComment=!0,void c.log("Comment empty")):""==e?(C.view.emptyCaptcha=!0,void c.log("Captcha empty")):void(C.view.cloading||(C.view.cloading=!0,g.postIc(a,e,i,n,r,o).then(function(e){var t;C.view.cloading=!1,void 0!==e.data.success?(t={id:e.data.success.insert_id,imgId:r,name:a,galId:o,email:i,comment:n,createDate:e.data.success.createDate},C.view.comments[s].push(t),C.view.grsCapCode="",C.view.grsCommText="",C.reloadCap(),C.view.emptyName=!1,C.view.emptyComment=!1,C.view.emptyCaptcha=!1,C.view.invalidMail=!1):void 0!==e.data.error?(C.reloadCap(),C.view.grsCapCode="",C.view.emptyCaptcha=!1,C.view.emptyCaptcha=!0):c.log("Eror code : "+e.data.error)},function(e){c.log(e)}))):(C.view.invalidMail=!0,void c.log("Email validation"))},C.validateEmail=function(e){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)},C.getFilmImageSrc=function(e){var t=C.items[e],e=C.params.theme;return C.getLightboxImageSource(t,parseInt(e.filmThumbWidth),parseInt(e.filmstripSize),"thumbnail")},C.reloadCap=function(){C.view.cloading||(C.view.cloading=!0,g.reloadCap().then(function(e){C.view.cloading=!1,void 0!==e.data.success&&(C.view.captcha=e.data.success)},function(e){c.log(e)}))},C.moveFC=function(e,t){var a,i=C.view.flp,n=C.items.length,r=!1,o=C.view.fcw,s=C.view.icw,g=C.view.ftw+C.view.ftm+2*(C.view.ftp+C.view.ftbw),h=c.settings.fmImMoveCount,l=Math.floor(Math.floor(s/g)/2),p=l<h?0===l?1:l:h;if("left"===e){if(o<=s+-1*i)return;a=m(i-(o-(s+-1*i))%g,!1)}else if("right"===e){if(0===i)return;a=m(i+-1*i%g,!0)}else"fromImgNav"===e&&(e=(n-t-1)*g,n=o-(s+-1*i),i<=(t=t*g*-1)||-1*t- -1*i<g?a=m(t,!0):e<=n||e-n<g?a=m(-1*(a=o-e-s),!1):r=!0);function m(e,t){var a=t?-1*parseInt(e/g):parseInt((o-(s+-1*e))/g);return 0<a&&(a=a<p?a:p,t?e+=a*g:e-=a*g),e}r||(C.view.flp=a,C.$$phase||C.$apply())},C.hideNav=function(){return C.view.icw+-1*C.view.flp>=C.view.fcw},C.grsSInf=function(e){C.view.shInf=!C.view.shInf},C.grsGetInfT=function(){return("first"==C.view.active?C.img:C.psImg).title},C.grsGetInfD=function(){return("first"==C.view.active?C.img:C.psImg).description},C.grsEnAp=function(){C.view.enAp=!C.view.enAp,C.view.enAp?C.doAutoPlay():C.view.setAutoplay&&i.cancel(C.view.setAutoplay)},C.grsPopupEnAp=function(){return C.view.enAp?"fa-"+C.params.theme.pause:"fa-"+C.params.theme.play},C.doAutoPlay=function(){var e=C.view;e.setAutoplay&&i.cancel(e.setAutoplay),e.setAutoplay=i(function(e){C.grsRight(!0)},e.apInt)},C.grsSFM=function(e){var t=document.getElementById("grsPopup");C.view.isFS?(document.webkitFullscreenEnabled?(document.webkitExitFullscreen(),C.view.isFS=!1):document.mozFullScreenEnabled?(document.mozCancelFullScreen(),C.view.isFS=!1):document.msFullscreenEnabled?(document.msExitFullscreen(),C.view.isFS=!1):document.fullscreenEnabled&&document.exitFullscreen&&(document.exitFullscreen(),C.view.isFS=!1),C.view.isFS||(C.view.isFSSmart=!1),C.$broadcast("resize::resize")):(document.fullscreenEnabled&&document.requestFullscreen?(t.requestFullscreen(),C.view.isFS=!0):document.webkitFullscreenEnabled?(t.webkitRequestFullscreen(),C.view.isFS=!0):document.mozFullScreenEnabled?(t.mozRequestFullScreen(),C.view.isFS=!0):document.msFullscreenEnabled&&(t.msRequestFullscreen(),C.view.isFS=!0),C.view.isFS&&i(function(){C.view.isFSSmart=!0},300),C.resizePc(screen.width,screen.height))},C.grsPopupOFCl=function(){return C.view.isFS?"fa-"+C.params.theme.min:"fa-"+C.params.theme.max},C.$on("resize::resize",function(){var e=o.innerWidth,t=o.innerHeight,a=C.params.shatts,i=e<700||t<500,n="1"==a.lightboxfullw,r=n||i?e:a.lightboxwidth,n=n||i?t:a.lightboxheight;C.view.isFS||(i=e<parseInt(r)?Math.floor(e):parseInt(r),a=parseInt(n),t<(a=e<parseInt(r)?Math.floor(a*i/parseInt(r)):a)&&(a=Math.floor(t),i=Math.floor(a*parseInt(r)/parseInt(n))),C.resizePc(i,a))}),C.resizeToWin=function(e){C.params.shatts.lightboxfullw=e?"1":"0",C.$broadcast("resize::resize")},C.resizePc=function(e,t){if(!C.view.mainAnimationEnd&&!C.view.noEffect)return c.log("Animation in progress, trying to resize containner"),C.view.cachResActW=e,void(C.view.cachResActH=t);var a,i=o.innerWidth,n=o.innerHeight;C.view.mcw=e,C.view.mch=t,C.view.isOCC?(C.view.ccw=Math.floor(40*C.view.mcw/100),C.view.icw=C.view.mcw-C.view.ccw,C.view.ccr=0):(C.view.ccw=Math.floor(40*C.view.mcw/100),C.view.ccr=-C.view.ccw,C.view.icw=C.view.mcw),i<400||n<200?(a=c.getWidthHeightForFmResize(50,parseInt(C.params.theme.filmThumbWidth),parseInt(C.params.theme.filmstripSize)),C.view.fs=a.height,C.view.ftw=a.width,C.view.ftm=parseInt(parseInt(C.params.theme.filmThumbMargin)/4),C.view.fmTop=parseInt(parseInt(C.params.theme.filmstripMarginTop)/4),C.view.fmBottom=parseInt(parseInt(C.params.theme.filmstripMarginBottom)/4),C.view.ftp=0,C.view.ftbw=0):i<700||n<500?(a=c.getWidthHeightForFmResize(80,parseInt(C.params.theme.filmThumbWidth),parseInt(C.params.theme.filmstripSize)),C.view.fs=a.height,C.view.ftw=a.width,C.view.ftm=parseInt(parseInt(C.params.theme.filmThumbMargin)/2),C.view.fmTop=parseInt(parseInt(C.params.theme.filmstripMarginTop)/2),C.view.fmBottom=parseInt(parseInt(C.params.theme.filmstripMarginBottom)/2),C.view.ftp=0,C.view.ftbw=0):(C.view.fs=parseInt(C.params.theme.filmstripSize),C.view.ftw=parseInt(C.params.theme.filmThumbWidth),C.view.ftm=parseInt(C.params.theme.filmThumbMargin),C.view.fmTop=parseInt(C.params.theme.filmstripMarginTop),C.view.fmBottom=parseInt(C.params.theme.filmstripMarginBottom),C.view.ftp=parseInt(C.params.theme.filmThumbPadding),C.view.ftbw="none"!=C.params.theme.filmThumbBorderStyle?parseInt(C.params.theme.filmThumbBorderWidth):0),C.view.flp=0,C.view.fch=C.view.fs+C.view.fmTop+C.view.fmBottom+2*(C.view.ftp+C.view.ftbw),C.view.ich="1"==C.params.shatts.lightboxfilmstrip?C.view.mch-C.view.fch:C.view.mch,C.view.cbcP="bottom"==C.params.theme.filmstripPos?"top":"bottom",!C.view.contButtOp&&jQuery(".grsPopupB").outerHeight()&&(jQuery(".grsPopupBc").css(C.view.cbcP,-jQuery(".grsPopupB").outerHeight()),c.log(C.view.cbcP+" #$ "+-jQuery(".grsPopupB").outerHeight())),0<C.items.length&&C.setFW(C.view.cImInG),0<C.view.grsCC.length&&C.selectImg(C.view.grsCC.shift(),!0),C.$$phase||C.$apply()},C.clBposRes=function(){var e,t,a,i="";return o.innerWidth===C.view.mcw&&(e=C.params.shatts,t=C.params.theme,a=C.view.isOCC,i="1"===e.lightboxfilmstrip&&-1!==t.filmstripPos.indexOf("top")?"grsPopupCoCClosResWithFilm":"1"===e.lightboxcontbutts&&-1===t.filmstripPos.indexOf("top")?"grsPopupCoCClosResWithContButts":"grsPopupCoCClosRes",i=a?"comm":i),i},C.grsOCC=function(e){var t=C.view;if(!t.isOCC){if(!t.mainAnimationEnd&&!t.noEffect)return c.log("Animation in progress, trying to open comments"),void(t.cachCmmAct=C.grsOCC);var a=t.mcw-t.ccw,i=""==t.active?"first":t.active,n=document.querySelector("."+i+" .forEffect"),r=document.querySelector(".grsPopupImC"),o=document.querySelector(".grsPopupCoC"),i=!!n&&n.querySelector("img");jQuery(r).animate({width:a},{duration:500,queue:!1,complete:function(){t.icw=a,t.isOCC=!0,0<C.items.length&&C.moveFC("fromImgNav",t.cImInG),C.$$phase||C.$apply()}}),jQuery(o).animate({right:0},{duration:500,queue:!1,complete:function(){C.$$phase||(t.ccr=0)}}),i&&(jQuery(n).animate({maxWidth:a},{duration:500,queue:!1,complete:function(){}}),jQuery(i).animate({maxWidth:a},{duration:500,queue:!1,complete:function(){0<t.grsCC.length&&C.selectImg(t.grsCC.shift(),!0)}}))}},C.grsCCC=function(e){var t=C.view,a=""==t.active?"first":t.active,i=document.querySelector("."+a+" .forEffect"),n=document.querySelector(".grsPopupImC"),r=document.querySelector(".grsPopupCoC"),a=!!i&&i.querySelector("img");if(!t.mainAnimationEnd&&!t.noEffect)return c.log("Animation in progress, trying to closw comments"),void(t.cachCmmAct=C.grsCCC);jQuery(n).animate({width:t.mcw},{duration:500,queue:!1,complete:function(){t.icw=t.mcw,t.isOCC=!1,C.$$phase||C.$apply()}}),jQuery(r).animate({right:-t.ccw},{duration:500,queue:!1,complete:function(){C.$$phase||(t.ccr=-t.ccw,0<C.items.length&&(t.flp=0,C.setFW(t.cImInG)))}}),a&&(jQuery(a).animate({maxWidth:t.mcw},{duration:500,queue:!1,complete:function(){0<t.grsCC.length&&C.selectImg(t.grsCC.shift(),!0)}}),jQuery(i).animate({maxWidth:t.mcw},{duration:500,queue:!1,complete:function(){}}))},C.grsCpFrSide=function(e){c.settings.closeLbOnSide&&C.grsCp()},C.grsCp=function(e){void 0!==e&&e.preventDefault(),document.webkitFullscreenEnabled&&document.webkitExitFullscreen?(document.webkitExitFullscreen(),C.view.isFS=!1):document.mozFullScreenEnabled&&document.mozCancelFullScreen?(document.mozCancelFullScreen(),C.view.isFS=!1):document.msFullscreenEnabled&&document.msExitFullscreen?(document.msExitFullscreen(),C.view.isFS=!1):document.fullscreenEnabled&&document.exitFullscreen&&(document.exitFullscreen(),C.view.isFS=!1),jQuery("html, body").removeClass("grsPopupParents");e={show:!1,grs:0,gallId:0,shatts:{},theme:{},pI:[],items:[],cP:0,pC:0,tC:0,lC:0,index:0};C.clearLh(),c.setPopObj(e)},C.setEffect=function(e){if("random"!==e){for(var t in C.grsEffects){for(var a in C.grsEffects[t].effects)if(a===e){C.view.effect.obj=C.grsEffects[t].effects[a],C.view.effect.name=a,C.view.effect.func=C.grsEffects[t].doEffect,C.view.effect.type=t;break}if(void 0!==C.view.effect.func)break}void 0===C.view.effect.func&&(C.view.effect.obj=C.grsEffects.noCutting.effects.fade,C.view.effect.name="fade",C.view.effect.func=C.grsEffects.noCutting.doEffect,C.view.effect.type="noCutting")}else C.setRandomEffect()},C.setRandomEffect=function(){var e,t=0,a=C.getRandomNum(1,Object.keys(C.grsEffects).length-2);for(e in C.grsEffects){if(t==a){var i,n=0,r=C.getRandomNum(0,Object.keys(C.grsEffects[e].effects).length-1);for(i in C.grsEffects[e].effects){if(n==r){C.view.effect.obj=C.grsEffects[e].effects[i],C.view.effect.name=i,C.view.effect.func=C.grsEffects[e].doEffect,C.view.effect.type=e;break}n++}}t++}},C.getRandomNum=function(e,t){return Math.floor(Math.random()*t)+e},C.grsNoEffect=function(e,t){"first"==C.view.active?(C.psImg=t,C.view.actImg="second",C.view.active="second"):"second"==C.view.active&&(C.img=t,C.view.actImg="first",C.view.active="first"),C.view.enAp&&C.doAutoPlay(),C.$$phase||C.$apply()},C.grsNoCuting=function(e,t){"first"===C.view.active?(C.view.active="second",C.psImg=t):"second"===C.view.active&&(C.view.active="first",C.img=t),C.$$phase||C.$apply()},C.grsXcutting=function(e,t){var a,i=C.view;"first"===i.active?(o=C.img,a=C.getLightboxImageSource(o,i.icw,i.ich,"main"),r="first",o="second",C.psImg=t,i.active="second",i.actImg="second"):(n=C.psImg,a=C.getLightboxImageSource(n,i.icw,i.ich,"main"),r="second",o="first",C.img=t,i.active="first",i.actImg="first");var n=document.querySelector("div."+r),t=document.querySelector("div."+o),i=n.querySelector("img");t.querySelector("img");C.$$phase||C.$apply();var r=n.childNodes[2].childNodes[1],o=r.childNodes[2],n=t.childNodes[2].childNodes[1],t=n.childNodes[2],i=i.getBoundingClientRect(),s=i.width,g=i.height,h=Math.floor(s/11);o&&r.removeChild(o),t&&n.removeChild(t);var l=document.createElement("div");l.style.width=12*h+"px",l.style.height=g+"px",l.style.position="absolute",l.style.top="0px",l.style.left="0px",l.style.textAlign="left",l.setAttribute("class","forlyalya");for(var p=C.effectsTiming.msForEffHor,m=0;m<12;m++){var c=m*h*-1,d=50*m,u=1500;11===m&&(d=50*(m-1)),"Safari"===C.browser.name&&(d=0,u=p[m]);var f=document.createElement("div");f.setAttribute("style","width:"+h+"px;height:"+g+"px;position:absolute;left:"+m*h+"px;top:0px;padding:0px;"+e.transformStyle+'margin:0px;background:url("'+a+'") no-repeat '+c+"px 0px;background-size:"+s+"px "+g+"px;-webkit-animation:"+e.name+" "+u+"ms ease-in-out "+d+"ms 1 normal both;-moz-animation:"+e.name+" "+u+"ms ease-in-out "+d+"ms 1 normal both;-ms-animation:"+e.name+" "+u+"ms ease-in-out "+d+"ms 1 normal both;-o-animation:"+e.name+" "+u+"ms ease-in-out "+d+"ms 1 normal both;animation:"+e.name+" "+u+"ms ease-in-out "+d+"ms 1 normal both;"),f.setAttribute("class","grsXorYCutMiniTransElem_"+m),l.appendChild(f)}r.appendChild(l)},C.grsYcutting=function(e,t){var a;"first"==C.view.active?(i=C.img,a=C.getLightboxImageSource(i,C.view.icw,C.view.ich,"main"),r="first",o="second",C.psImg=t,C.view.active="second",C.view.actImg="second"):(n=C.psImg,a=C.getLightboxImageSource(n,C.view.icw,C.view.ich,"main"),r="second",o="first",C.img=t,C.view.active="first",C.view.actImg="first");var i=document.querySelector("div."+r),n=document.querySelector("div."+o),t=i.querySelector("img");n.querySelector("img");C.$$phase||C.$apply();var r=i.childNodes[2].childNodes[1],o=r.childNodes[2],i=n.childNodes[2].childNodes[1],n=i.childNodes[2],t=t.getBoundingClientRect(),s=t.width,g=t.height,h=Math.floor(g/11);o&&r.removeChild(o),n&&i.removeChild(n);var l=document.createElement("div");l.style.width=s+"px",l.style.height=12*h+"px",l.style.position="absolute",l.style.top="0px",l.style.left="0px",l.style.textAlign="left",l.setAttribute("class","forlyalya");for(var p=C.effectsTiming.msForEffHor,m=0;m<12;m++){var c=m*h*-1,d=50*m,u=1500;11==m&&(d=50*(m-1)),"Safari"==C.browser.name&&(d=0,u=p[m]);var f=document.createElement("div");f.setAttribute("style","width:"+s+"px;height:"+h+"px;position:absolute;left:0px;top:"+m*h+"px;"+e.transformStyle+'background:url("'+a+'") no-repeat 0px '+c+"px;background-size:"+s+"px "+g+"px;-webkit-animation:"+e.name+" "+u+"ms ease-in "+d+"ms 1 normal both;-moz-animation:"+e.name+" "+u+"ms ease-in "+d+"ms 1 normal both;-ms-animation:"+e.name+" "+u+"ms ease-in "+d+"ms 1 normal both;-o-animation:"+e.name+" "+u+"ms ease-in "+d+"ms 1 normal both;animation:"+e.name+" "+u+"ms ease-in "+d+'ms 1 normal both;" '),f.setAttribute("class","grsXorYCutMiniTransElem_"+m),l.appendChild(f)}r.appendChild(l)},C.grsXYcutting=function(e,t){var a;"first"==C.view.active?(i=C.img,a=C.getLightboxImageSource(i,C.view.icw,C.view.ich,"main"),r="first",o="second",C.psImg=t,C.view.active="second",C.view.actImg="second"):(n=C.psImg,a=C.getLightboxImageSource(n,C.view.icw,C.view.ich,"main"),r="second",o="first",C.img=t,C.view.active="first",C.view.actImg="first");var i=document.querySelector("div."+r),n=document.querySelector("div."+o),t=i.querySelector("img");n.querySelector("img");C.$$phase||C.$apply();var r=i.childNodes[2].childNodes[1],o=r.childNodes[2],i=n.childNodes[2].childNodes[1],n=i.childNodes[2],t=t.getBoundingClientRect(),s=t.width,g=t.height,h=Math.floor(s/5),l=Math.floor(g/5),p=document.createElement("div");p.style.width=6*h+"px",p.style.height=6*l+"px",p.style.position="absolute",p.style.top="0px",p.style.left="0px",p.style.textAlign="left",p.setAttribute("class","forlyalya"),o&&r.removeChild(o),n&&i.removeChild(n);for(var m=0,c=0,d=C.effectsTiming.msForEff,u=0;u<6;u++){c="fun"==e.type?70*u+50*u:0;for(var f=0;f<6;f++){var v=u*l*-1,w=f*h*-1,I=1e3,c="fun"==e.type?c+70:30*m;"Safari"==C.browser.name&&(c=0,I=d[m]);var b=document.createElement("div");b.setAttribute("style","width:"+h+"px;height:"+l+"px;float:left;"+e.transformStyle+'background:url("'+a+'") no-repeat '+w+"px "+v+"px;background-size:"+s+"px "+g+"px;-webkit-animation:"+e.name+" "+I+"ms ease-in-out "+c+"ms 1 normal both;-moz-animation:"+e.name+" "+I+"ms ease-in-out "+c+"ms 1 normal both;-ms-animation:"+e.name+" "+I+"ms ease-in-out "+c+"ms 1 normal both;-o-animation:"+e.name+" "+I+"ms ease-in-out "+c+"ms 1 normal both;animation:"+e.name+" "+I+"ms ease-in-out "+c+'ms 1 normal both;" '),b.setAttribute("class","grsXYCutMiniTransElem_"+m),p.appendChild(b),m++}}r.appendChild(p)},C.grsXYcuttingIn=function(e,t){"first"==C.view.active?(n="first",o="second",C.psImg=t,C.view.active="second"):(n="second",o="first",C.img=t,C.view.active="first");var a=document.querySelector("div."+n),i=document.querySelector("div."+o),n=(a.querySelector("img"),i.querySelector("img")),r=C.getLightboxImageSource(t,C.view.icw,C.view.ich,"main");n.setAttribute("src",r),C.$$phase||C.$apply(),C.view.actImg="second"==C.view.active?"first":"second";var o=a.childNodes[2].childNodes[1],t=o.childNodes[2],a=i.childNodes[2].childNodes[1],i=a.childNodes[2],s=n.clientWidth,g=n.clientHeight;t&&o.removeChild(t),i&&a.removeChild(i);var h=Math.floor(s/5),l=Math.floor(g/5),p=document.createElement("div");p.style.width=6*h+"px",p.style.height=6*l+"px",p.style.position="absolute",p.style.top="0px",p.style.left="0px",p.style.textAlign="left",p.setAttribute("class","forlyalya");for(var m=0,c=0,d=C.effectsTiming.msForEff,u=0;u<6;u++){c="fun"==e.type?50*u+50*u:0;for(var f=0;f<6;f++){var v=u*l*-1,w=f*h*-1,I=1200,c="fun"==e.type?c+50:30*m;"Safari"==C.browser.name&&(c=0,I=d[m]);var b=document.createElement("div");b.setAttribute("style","width:"+h+"px;height:"+l+"px;float:left;"+e.transformStyle+'background:url("'+r+'") no-repeat '+w+"px "+v+"px;background-size:"+s+"px "+g+"px;-webkit-animation:"+e.name+" "+I+"ms ease-in-out "+c+"ms 1 normal both;-moz-animation:"+e.name+" "+I+"ms ease-in-out "+c+"ms 1 normal both;-ms-animation:"+e.name+" "+I+"ms ease-in-out "+c+"ms 1 normal both;-o-animation:"+e.name+" "+I+"ms ease-in-out "+c+"ms 1 normal both;animation:"+e.name+" "+I+"ms ease-in-out "+c+'ms 1 normal both;" '),b.setAttribute("class","grsXYInCutMiniTransElem_"+m),p.appendChild(b),m++}}a.appendChild(p)},C.classFfI=function(){return"noCutting"!=C.view.effect.type?"first"==C.view.actImg?"opset":"opzero":void 0===C.view.firstIn?"opzero":"opset"},C.classFsI=function(){return"noCutting"!=C.view.effect.type?"second"==C.view.actImg?"opset":"opzero":void 0===C.view.firstIn||C.view.firstIn?"opzero":"opset"},C.classFfD=function(){return C[C.view.effect.type+"_fD"]()},C.classFsD=function(){return C[C.view.effect.type+"_sD"]()},C.noEffect_fD=function(){return"first"===C.view.active?"active":"pasive"},C.noEffect_sD=function(){return"second"===C.view.active?"active":"pasive"},C.noCutting_fD=function(){return"first"===C.view.active?C.view.effect.obj.in+" active":"second"===C.view.active?C.view.effect.obj.out+" pasive":void 0},C.noCutting_sD=function(){return"second"===C.view.active?C.view.effect.obj.in+" active":"first"===C.view.active?C.view.effect.obj.out+" pasive":void 0},C.cuttingX_fD=function(){return(C.view.firstIn?"grsFrInEff ":"")+("first"==C.view.active?C.view.effect.obj.activeC+" active":"")},C.cuttingX_sD=function(){return"second"==C.view.active?C.view.effect.obj.activeC+" active":""},C.cuttingY_fD=function(){return(C.view.firstIn?"grsFrInEff ":"")+("first"==C.view.active?C.view.effect.obj.activeC+" active":"")},C.cuttingY_sD=function(){return"second"==C.view.active?C.view.effect.obj.activeC+" active":""},C.cuttingXY_fD=function(){return(C.view.firstIn?"grsFrInEff ":"")+("first"==C.view.active?C.view.effect.obj.activeC+" active":"")},C.cuttingXY_sD=function(){return"second"==C.view.active?C.view.effect.obj.activeC+" active":""},C.cuttingXYIn_fD=function(){return(C.view.firstIn?"grsFrInEff ":"")+("first"==C.view.active?"grsFadeIn grsAnDur active":C.view.effect.obj.pasiveC)},C.cuttingXYIn_sD=function(){return"second"==C.view.active?"grsFadeIn grsAnDur active":C.view.effect.obj.pasiveC},C.PrefixedEvent=function(t){for(var e=C.browser.pfx,a=0;a<e.length;a++)e[a]||(t=t.toLowerCase()),document.querySelector("body").addEventListener(e[a]+t,function(e){if("animationend"==t){if(-1!=e.target.getAttribute("class").indexOf("grsFrInEff"))return c.log('end of first "in" grsFrInEff'),C.view.mainAnimationEnd=!0,C.view.firstIn=!1,void 0!==C.view.cachResActW?(C.resizePc(C.view.cachResActW,C.view.cachResActH),delete C.view.cachResActW,void delete C.view.cachResActH):void 0!==C.view.cachCmmAct?(C.view.cachCmmAct(),void delete C.view.cachCmmAct):(0<C.view.grsCC.length?C.selectImg(C.view.grsCC.shift(),!0):(C.view.enAp&&C.doAutoPlay(),c.log('end of first "in" !scope.$$phase --- '+!C.$$phase)),void C.$apply());if(-1!=e.target.getAttribute("class").indexOf("inAnimationEnd"))return c.log("inAnimationEnd anim ------------------- "),C.view.inAnimationEnd=!0,c.log("scope.view.inAnimationEnd --- "+C.view.inAnimationEnd),c.log("scope.view.outAnimationEnd --- "+C.view.outAnimationEnd),C.view.outAnimationEnd?(C.view.firstIn=!1,C.view.mainAnimationEnd=!0,void 0!==C.view.cachResActW?(C.resizePc(C.view.cachResActW,C.view.cachResActH),delete C.view.cachResActW,void delete C.view.cachResActH):void 0!==C.view.cachCmmAct?(C.view.cachCmmAct(),void delete C.view.cachCmmAct):(0<C.view.grsCC.length?(c.log("scope.view.grsCC.shift in ------------- "),c.log(C.view.grsCC),C.selectImg(C.view.grsCC.shift(),!0)):C.view.enAp&&C.doAutoPlay(),void C.$apply())):void 0;if(-1!=e.target.getAttribute("class").indexOf("outAnimationEnd"))return c.log("outAnimationEnd anim ------------- "),C.view.outAnimationEnd=!0,c.log("scope.view.outAnimationEnd --- "+C.view.outAnimationEnd),c.log("scope.view.inAnimationEnd --- "+C.view.inAnimationEnd),C.view.inAnimationEnd?(C.view.firstIn=!1,C.view.mainAnimationEnd=!0,void 0!==C.view.cachResActW?(C.resizePc(C.view.cachResActW,C.view.cachResActH),delete C.view.cachResActW,void delete C.view.cachResActH):void 0!==C.view.cachCmmAct?(C.view.cachCmmAct(),void delete C.view.cachCmmAct):(0<C.view.grsCC.length&&(c.log("scope.view.grsCC.shift ------------- "),c.log(C.view.grsCC),C.selectImg(C.view.grsCC.shift(),!0)),C.view.enAp&&C.doAutoPlay(),void C.$apply())):void 0;if(-1!=e.target.getAttribute("class").indexOf("grsXorYCutMiniTransElem_11"))return C.view.mainAnimationEnd=!0,void 0!==C.view.cachResActW?(C.resizePc(C.view.cachResActW,C.view.cachResActH),delete C.view.cachResActW,void delete C.view.cachResActH):void 0!==C.view.cachCmmAct?(C.view.cachCmmAct(),void delete C.view.cachCmmAct):(0<C.view.grsCC.length?C.selectImg(C.view.grsCC.shift(),!0):(C.view.enAp&&C.doAutoPlay(),c.log("grsXorYCutMiniTransElem_11 end ---------- "),c.log(C.view.grsCC)),void C.$apply());if(-1!=e.target.getAttribute("class").indexOf("grsXYCutMiniTransElem_35"))return C.view.mainAnimationEnd=!0,void 0!==C.view.cachResActW?(C.resizePc(C.view.cachResActW,C.view.cachResActH),delete C.view.cachResActW,void delete C.view.cachResActH):void 0!==C.view.cachCmmAct?(C.view.cachCmmAct(),void delete C.view.cachCmmAct):(0<C.view.grsCC.length?C.selectImg(C.view.grsCC.shift(),!0):(C.view.enAp&&C.doAutoPlay(),c.log("grsXYCutMiniTransElem_35 end ---------- "),c.log(C.view.grsCC)),void C.$apply());if(-1!=e.target.getAttribute("class").indexOf("grsXYInCutMiniTransElem_35")){C.view.actImg="second"==C.view.actImg?"first":"second",C.view.mainAnimationEnd=!0;e=document.querySelector("div."+C.view.active).childNodes[2].childNodes[1];return(forlyalya=e.childNodes[2],forlyalya&&e.removeChild(forlyalya),void 0!==C.view.cachResActW)?(C.resizePc(C.view.cachResActW,C.view.cachResActH),delete C.view.cachResActW,delete C.view.cachResActH,void C.$apply()):(void 0!==C.view.cachCmmAct?(C.view.cachCmmAct(),delete C.view.cachCmmAct):0<C.view.grsCC.length?C.selectImg(C.view.grsCC.shift(),!0):C.view.enAp&&C.doAutoPlay(),void C.$apply())}}},!1)},C.keyBoardEvents=function(){document.addEventListener("keydown",function(e){if(C.options.show){var t=e.key;if("Control"!==t&&!e.ctrlKey){switch(t){case"ArrowRight":case"Right":C.grsRight();break;case"ArrowLeft":case"Left":C.grsLeft();break;case"Escape":case"Esc":C.grsCp();break;case" ":case"Spacebar":break;default:return}C.$$phase||C.$apply()}}},!1)},C.fullscreenChange=function(){document.addEventListener("webkitfullscreenchange",function(e){C.view.isFSSmart&&C.grsSFM()}),document.addEventListener("mozfullscreenchange",function(e){C.view.isFSSmart&&C.grsSFM()}),document.addEventListener("fullscreenchange",function(e){C.view.isFSSmart&&C.grsSFM()}),document.addEventListener("MSFullscreenChange",function(e){C.view.isFSSmart&&C.grsSFM()})},C.PrefixedEvent("AnimationEnd"),C.keyBoardEvents(),C.fullscreenChange(),C.getTrans=c.getTrans}}}]),grsApp.directive("grsMosaic",["$filter","GrsFactory","GrsService","$window","$location",function(e,a,i,n,r){return{restrict:"E",transclude:!0,scope:{params:"="},templateUrl:i.getViewsTemplateUrl("grsMosaic"),link:function(o,t,e){o.sortingOrder="id",o.reverse=!0,o.message={type:"success",show:!1,text:""},o.params.contHeight=50,o.params.contHeightFirstBinding=!1,o.params.loadedCount=0,o.params.prevContWidth=!1,o.params.prevLoadedCount=0,o.params.prevCP=!1,o.pageination={pN:0,forGallery:!0,grs:o.params.grs,items:o.params.data.images,navView:o.params.shatts.pagination,gallery:o.params.shatts.id,currentPage:0,totalcount:-1,loadedCount:0,itemsPerPage:parseInt(o.params.shatts.imagesperpage),orderBy:o.params.shatts.orderby,ordering:o.params.shatts.ordering,pagedItems:[],scrolling:!1,loading:!0,positioning:function(){o.MosaicPositioning()},message:function(e,t,a){o.message.show=e,o.message.text=t,o.message.type=void 0!==a?a:"success"},checkScrolling:function(){return i.log("ekanq mas scrolling"),o.checkScrolling()}},o.clickAction=function(e,t){void 0!==t&&t.preventDefault(),o["clickAction"+o.params.shatts.clickaction](e)},o.clickActiondoNothing=function(){},o.clickActionopenLightbox=function(e){var t=o.params,a=o.pageination;o.setLh(),i.setPopObj({show:!0,grs:t.grs,gallId:t.shatts.id,shatts:t.shatts,theme:t.data.theme.lightbox,orderby:t.shatts.orderby,ordering:t.shatts.ordering,items:[],pI:a.pagedItems,cP:a.currentPage,pC:a.pagesCount,tC:a.totalcount,lC:a.loadedCount,index:e})},o.clickActionopenLink=function(e){i.link(o.pageination.pagedItems[o.pageination.currentPage][e],o.params.shatts.openlinktarget)},o.$on("resize::resize",function(){o.pageination.gallExists&&(o.pageination.positioning(),o.$$phase||o.$apply())}),o.$on("scroll::scroll",function(){var e,t,a;"scrolling"===o.pageination.navView&&(o.pageination.loading||(e=(a=jQuery("#grsGal"+o.params.grs)).offset().top,t=a.innerHeight(),(a=n.innerHeight)/10<n.pageYOffset+a-(e+t)?(o.pageination.scrolling=!0,i.log("thumb mek 10ic ancanq")):o.pageination.scrolling=!1,o.$$phase||o.$apply()))}),o.checkScrolling=function(){if("scrolling"===o.pageination.navView){var e=jQuery("html").innerHeight();if(i.log("jjj "+(n.pageYOffset+n.innerHeight)),i.log("vvv "+e),i.log("grsGallHeight "+t.find(".grsImsCont").innerHeight()),n.innerHeight>=e||n.pageYOffset+n.innerHeight>e){i.log("activate scrolling"),i.log("new val for right fireing watcher");e=o.pageination.scrolling||2;return i.log("gaga"+e),e*e}return!1}},o.$watch(function(){if("scrolling"==o.pageination.navView){if(o.pageination.loading)return i.log("Height watcher loading is true"),void i.log("Height watcher loading params height "+o.params.contHeight);var e=t.find(".grsImsCont").innerHeight();0!=e?Math.round(o.params.contHeight)!=Math.round(e)?i.log("live height not set or same live height"):o.params.loadedCount!=o.pageination.loadedCount?(o.params.loadedCount=o.pageination.loadedCount,o.pageination.scrolling=o.checkScrolling()):i.log("loaded - "+o.pageination.loadedCount):i.log("Height watcher , gallCont@ der live height chuni")}}),o.imgLoaded=function(e,t){o.pageination.pagedItems[o.pageination.currentPage][e].show=!0},o.setLh=function(){r.path("/grs/"+o.params.grs).replace()},o.params.getDataById=function(e,t,a){var i={},n=0;itemsCount=o.pageination.items.length;for(var r=0;r<itemsCount;r++)if(o.pageination.items[r].id==e){n=r;break}return i.imgData=o.pageination.items[n],i.curentImgIndex=n,i},o.MosaicPositioning=function(){a["Mosaic"+i.toUpperCaseFl(o.params.shatts.type)+"Positioning"](o.params,o.pageination,"")},o.getImageSrc=function(e){e=o.pageination.pagedItems[o.pageination.currentPage][e];return i.getImageSource(e,"mosaic")},o.grsShTC=function(){return i.grsShTC(o.params.shatts.title,o.params.data.theme.mosaic.mosaicTEffect)},o.shVIc=function(e){return i.shVIc(o.pageination.pagedItems[o.pageination.currentPage][e])},o.grsOnhv=function(){return i.grsOnhv(o.params.shatts.title)?"grsTOnhover":""},o.grsShMC=function(){return i.grsShMC(o.params.shatts.title,o.params.data.theme.mosaic.mosaicTEffect)},o.CheckGrsHash=function(){var e=n.location.hash,t=o.params.grs,a=!1;if(-1!==e.indexOf("grs")){e=e.split("/");if(e[2]==t&&3<e.length){imageId=e.pop();for(var i=0;i<o.pageination.pagedItems[0].length;i++)if(o.pageination.pagedItems[0][i].id==imageId){a=!0;break}a?o.clickAction(i):o.clickAction("hash-"+imageId)}}},o.$watch(function(){return i.settingsReady},function(e,t){e&&a.getGalleryData(0,o.pageination.itemsPerPage,o.params.shatts.id,1,o.params.shatts.orderby,o.params.shatts.ordering,o.params.shatts.theme,o.params.shatts.view).then(function(e){o.pageination.gallExists=e.data.gallExists,o.pageination.loading=!1,o.params.data.theme.mosaic=JSON.parse(e.data.theme.mosaic),o.params.data.theme.lightbox=JSON.parse(e.data.theme.lightbox),o.pageination.pagedItems[0]=e.data.images,o.pageination.totalcount=e.data.count,o.pageination.pagesCount=Math.ceil(o.pageination.totalcount/o.pageination.itemsPerPage),o.pageination.loadedCount=0<o.pageination.pagesCount?1:0,o.pageination.gallExists&&(o.pageination.positioning(),o.CheckGrsHash())},function(e){i.log(e)})},!0)}}}]),grsApp.directive("grsMasonry",["$filter","GrsFactory","GrsService","$window","$location",function(e,a,i,r,o){return{restrict:"E",transclude:!0,scope:{params:"="},templateUrl:i.getViewsTemplateUrl("grsMasonry"),link:function(n,t,e){n.sortingOrder="id",n.reverse=!0,n.message={type:"success",show:!1,text:""},n.params.contHeight=50,n.params.contHeightFirstBinding=!1,n.params.loadedCount=0,n.pageination={pN:0,forGallery:!0,grs:n.params.grs,items:n.params.data.images,navView:n.params.shatts.pagination,gallery:n.params.shatts.id,currentPage:0,totalcount:-1,loadedCount:0,view:n.params.shatts.pagination,itemsPerPage:parseInt(n.params.shatts.imagesperpage),orderBy:n.params.shatts.orderby,ordering:n.params.shatts.ordering,pagedItems:[],scrolling:!1,loading:!0,positioning:function(){n.MasonryPositioning()},message:function(e,t,a){n.message.show=e,n.message.text=t,n.message.type=void 0!==a?a:"success"},checkScrolling:function(){return i.log("ekanq mas scrolling"),n.checkScrolling()}},n.clickAction=function(e,t){void 0!==t&&t.preventDefault(),n["clickAction"+n.params.shatts.clickaction](e)},n.clickActiondoNothing=function(){},n.clickActionopenLightbox=function(e){var t=n.params,a=n.pageination;n.setLh(),i.setPopObj({show:!0,grs:t.grs,gallId:t.shatts.id,shatts:t.shatts,theme:t.data.theme.lightbox,orderby:t.shatts.orderby,ordering:t.shatts.ordering,items:[],pI:a.pagedItems,cP:a.currentPage,pC:a.pagesCount,tC:a.totalcount,lC:a.loadedCount,index:e})},n.clickActionopenLink=function(e){i.link(n.pageination.pagedItems[n.pageination.currentPage][e],n.params.shatts.openlinktarget)},n.$on("resize::resize",function(){n.pageination.gallExists&&(n.pageination.positioning(),n.$$phase||n.$apply())}),n.$on("scroll::scroll",function(){var e,t,a,i;"scrolling"==n.pageination.navView&&(n.pageination.loading||(e=jQuery("#grsGal"+n.params.grs).offset().top,t=jQuery("#grsGal"+n.params.grs).innerHeight(),a=r.innerHeight,i=r.pageYOffset+a,n.pageination.scrolling=a/10<i-(e+t),n.$$phase||n.$apply()))}),n.checkScrolling=function(){if("scrolling"==n.pageination.navView){var e=jQuery("html").innerHeight();if(r.innerHeight>=e||r.pageYOffset+r.innerHeight>e){e=n.pageination.scrolling||2;return e*e}return!1}},n.$watch(function(){var e;"scrolling"==n.pageination.navView&&(n.pageination.loading||0!=(e=t.find(".grsImsCont").innerHeight())&&(Math.round(n.params.contHeight)!=Math.round(e)?i.log("live height@ not set"):n.params.loadedCount!=n.pageination.loadedCount?(n.params.loadedCount=n.pageination.loadedCount,n.pageination.scrolling=n.checkScrolling()):i.log("loaded - "+n.pageination.loadedCount)))}),n.imgLoaded=function(e,t){n.pageination.pagedItems[n.pageination.currentPage][e].show=!0},n.setLh=function(){o.path("/grs/"+n.params.grs).replace()},n.MasonryPositioning=function(){a["Masonry"+i.toUpperCaseFl(n.params.shatts.type)+"Positioning"](n.params,n.pageination,"")},n.grsShTC=function(){return i.grsShTC(n.params.shatts.title,n.params.data.theme.masonry.masonryTEffect)},n.shVIc=function(e){return i.shVIc(n.pageination.pagedItems[n.pageination.currentPage][e])},n.grsOnhv=function(){return i.grsOnhv(n.params.shatts.title)?"grsTOnhover":""},n.grsShMC=function(){return i.grsShMC(n.params.shatts.title,n.params.data.theme.masonry.masonryTEffect)},n.getImageSrc=function(e){e=n.pageination.pagedItems[n.pageination.currentPage][e];return i.getImageSource(e,"masonry")},n.scrollTop=function(){jQuery("html, body").animate({scrollTop:jQuery("#grsGal"+n.params.grs).offset().top-100},500)},n.CheckGrsHash=function(){var e=r.location.hash,t=n.params.grs,a=!1;if(-1!==e.indexOf("grs")){e=e.split("/");if(e[2]==t&&3<e.length){imageId=e.pop();for(var i=0;i<n.pageination.pagedItems[0].length;i++)if(n.pageination.pagedItems[0][i].id==imageId){a=!0;break}a?n.clickAction(i):n.clickAction("hash-"+imageId)}}},n.$watch(function(){return i.settingsReady},function(e,t){e&&a.getGalleryData(0,n.pageination.itemsPerPage,n.params.shatts.id,1,n.params.shatts.orderby,n.params.shatts.ordering,n.params.shatts.theme,n.params.shatts.view).then(function(e){n.pageination.gallExists=e.data.gallExists,n.pageination.loading=!1,n.params.data.theme.masonry=JSON.parse(e.data.theme.masonry),n.params.data.theme.lightbox=JSON.parse(e.data.theme.lightbox),n.pageination.pagedItems[0]=e.data.images,n.pageination.totalcount=e.data.count,n.pageination.pagesCount=Math.ceil(n.pageination.totalcount/n.pageination.itemsPerPage),n.pageination.loadedCount=0<n.pageination.pagesCount?1:0,n.pageination.gallExists&&(n.pageination.positioning(),n.CheckGrsHash())},function(e){i.log(e)})},!0)}}}]),grsApp.directive("grsCarousel3d",["$filter","GrsFactory","GrsService","$window","$location","$interval",function(e,a,d,n,i,o){return{restrict:"E",transclude:!0,scope:{params:"="},templateUrl:d.getViewsTemplateUrl("grsCarousel3d"),link:function(c,e,t){c.sortingOrder="id",c.reverse=!0,c.message={type:"success",show:!1,text:""},c.params.contHeight=50,c.params.flp=0,c.params.contHeightFirstBinding=!1,c.params.loadedCount=0,c.params.scrollWaitInterval=110,c.params.lastScrollTime=(new Date).getTime(),c.params.currentImageIndexes={local:0,page:0,image:0},c.params.clickedImageIndexes={local:-1,page:0,image:0},c.params.scrollToThe="nothing",c.params.firstViewIsDone=!1,c.params.totalCountIsLess=!1,c.pageination={pN:0,forGallery:!0,grs:c.params.grs,items:[],navView:"scrolling",gallery:c.params.shatts.id,currentPage:0,totalcount:-1,loadedCount:0,itemsPerPage:parseInt(c.params.shatts.imagesperpage),orderBy:c.params.shatts.orderby,ordering:c.params.shatts.ordering,pagedItems:[],viewItemsCount:parseInt(c.params.shatts.viewitemscount),viewItems:[],loading:!0,positioning:function(){a.Carousel3dPositioning(c.params,this,c.scrollToImage,c.moveCC)},message:function(e,t,a){c.message.show=e,c.message.text=t,c.message.type=angular.isUndefined(a)?"success":a},checkScrolling:function(){return d.log("ekanq mas scrolling"),c.checkScrolling()},getRightDoorIndex:function(){return(c.params.currentImageIndexes.local+Math.ceil(this.viewItemsCount/2)-1)%this.viewItemsCount},getLeftDoorIndex:function(){var e=this.getRightDoorIndex();return e+1>=this.viewItemsCount?0:e+1},getPrevImgIndexes:function(e,t){var a,t=0==t?0==e?(a=Math.ceil(c.pageination.totalcount/c.pageination.itemsPerPage)-1,c.pageination.totalcount-c.pageination.itemsPerPage*a-1):(a=e-1,c.pageination.itemsPerPage-1):(a=e,t-1);return{page:a,image:t}},getNextImgIndexes:function(e,t){var a;return currentPageLength=e==Math.ceil(c.pageination.totalcount/c.pageination.itemsPerPage)-1?c.pageination.totalcount-c.pageination.itemsPerPage*e:c.pageination.itemsPerPage,t=t==currentPageLength-1?(a=e==Math.ceil(c.pageination.totalcount/c.pageination.itemsPerPage)-1?0:e+1,0):(a=e,t+1),{page:a,image:t}}},c.moveLeft=function(e){void 0!==e&&e.preventDefault(),c.moveCC("left")},c.moveRight=function(e){void 0!==e&&e.preventDefault(),c.moveCC("right")},c.moveCC=function(e){var t,a,i,n=c.pageination.viewItems,r=n.length,o=c.params.currentImageIndexes.local,s=c.pageination.getRightDoorIndex(),g=c.pageination.getLeftDoorIndex();if("left"===e){var h,l={css:n[s].picCSS,params:n[s].params,indexes:n[s].indexes},p=c.pageination.getNextImgIndexes(l.indexes.page,l.indexes.image);if(void 0===c.pageination.pagedItems[p.page]||void 0===c.pageination.pagedItems[p.page][p.image])return c.pageination.pN=p.page,d.log("Scrolling to left. Need page="+p.page+",image="+p.image),!(c.params.scrollToThe="left");for(c.pageination.totalcount==c.pageination.viewItemsCount-1||c.pageination.totalcount==c.pageination.viewItemsCount&&!c.params.totalCountIsLess||c.params.totalCountIsLess?(h=angular.copy(c.pageination.pagedItems[p.page][p.image])).nId=(new Date).getUTCMilliseconds():h=c.pageination.pagedItems[p.page][p.image],t={css:n[r-1].picCSS,params:n[r-1].params},a=r-1;-1<a;a--)(i=a-1<0?r-1:a-1)==r-1?(n[a].picCSS=t.css,n[a].params=t.params):(n[a].picCSS=n[i].picCSS,n[a].params=n[i].params);s=(s+1)%r,h.picCSS=l.css,h.params=l.params,h.indexes={page:p.page,image:p.image},n[s]=h,o=(c.params.currentImageIndexes.local+1)%r}else if("right"===e){l={css:n[g].picCSS,params:n[g].params,indexes:n[g].indexes};var m,e=c.pageination.getPrevImgIndexes(l.indexes.page,l.indexes.image);if(void 0===c.pageination.pagedItems[e.page]||void 0===c.pageination.pagedItems[e.page][e.image])return c.pageination.pN=e.page,d.log("Scrolling to right. Need page="+e.page),!(c.params.scrollToThe="right");for(c.pageination.totalcount==c.pageination.viewItemsCount-1||c.pageination.totalcount==c.pageination.viewItemsCount&&!c.params.totalCountIsLess||c.params.totalCountIsLess?(m=angular.copy(c.pageination.pagedItems[e.page][e.image]),e.nId=(new Date).getUTCMilliseconds()):m=c.pageination.pagedItems[e.page][e.image],t={css:n[0].picCSS,params:n[0].params},a=0;a<r;a++)0==(i=a+1==r?0:a+1)?(n[a].picCSS=t.css,n[a].params=t.params):(n[a].picCSS=n[i].picCSS,n[a].params=n[i].params);g=0==g?r-1:g-1,m.picCSS=l.css,m.params=l.params,m.indexes={page:e.page,image:e.image},n[g]=m,o=c.params.currentImageIndexes.local-1<0?r-1:c.params.currentImageIndexes.local-1}return c.params.currentImageIndexes={local:o,page:n[o].indexes.page,image:n[o].indexes.image},c.params.clickedImageIndexes.local==c.params.currentImageIndexes.local&&(c.params.clickedImageIndexes.local=-1),c.params.scrollToThe="nothing",!0},c.scrollToImage=function(e,t){if(!(e<0)){c.pageination.viewItems;var a,i=c.pageination.viewItemsCount,n=0;if(e>c.params.currentImageIndexes.local?n=e-c.params.currentImageIndexes.local<i/2?(a="left",e-c.params.currentImageIndexes.local):(a="right",i-(e-c.params.currentImageIndexes.local)):e<c.params.currentImageIndexes.local&&(n=c.params.currentImageIndexes.local-e<=i/2?(a="right",c.params.currentImageIndexes.local-e):(a="left",i-(c.params.currentImageIndexes.local-e))),!0===t)var r=o(function(){!(n--<=0)&&c.moveCC(a)||o.cancel(r)},c.params.scrollWaitInterval);else for(;0<n--;)c.moveCC(a)}},"scroll"!==c.params.shatts.nav&&"both"!==c.params.shatts.nav||e.find(".grsCarousel3d").bind("mousewheel DOMMouseScroll",function(e){var t,a=(new Date).getTime();a-c.params.lastScrollTime>=c.params.scrollWaitInterval&&(c.params.lastScrollTime=a,t=e.originalEvent.wheelDelta,a=e.originalEvent.deltaY||e.originalEvent.detail,angular.isUndefined(t)?angular.isUndefined(a)||(0<a?c.moveCC("left"):c.moveCC("right")):0<t?c.moveCC("right"):c.moveCC("left")),e.preventDefault(),c.$$phase||c.$apply()}),c.clickAction=function(e,t,a,i){void 0!==i&&i.preventDefault(),!isNaN(parseFloat(e))&&isFinite(e)&&void 0!==t&&void 0!==a&&(c.params.clickedImageIndexes={local:e,page:t,image:a},c.scrollToImage(e,!0)),c["clickAction"+c.params.shatts.clickaction](e,t,a)},c.clickActiondoNothing=function(){},c.clickActionopenLightbox=function(e,t,a){var i,n=c.params,r=c.pageination,e=!isNaN(parseFloat(e))&&isFinite(e)&&void 0!==t&&void 0!==a?(i=c.pageination.viewItems[e].indexes.page,c.pageination.viewItems[e].indexes.image):(i=r.currentPage,e);c.setLh(),d.setPopObj({show:!0,grs:n.grs,gallId:n.shatts.id,shatts:n.shatts,theme:n.data.theme.lightbox,orderby:n.shatts.orderby,ordering:n.shatts.ordering,items:[],pI:r.pagedItems,cP:i,pC:r.pagesCount,tC:r.totalcount,lC:r.loadedCount,index:e})},c.clickActionopenLink=function(e,t,a){!isNaN(parseFloat(e))&&isFinite(e)&&void 0!==t&&void 0!==a?d.link(c.pageination.viewItems[e],c.params.shatts.openlinktarget):d.link(c.pageination.pagedItems[c.pageination.currentPage][e],c.params.shatts.openlinktarget)},c.$on("resize::resize",function(){c.pageination.gallExists&&(c.pageination.positioning(),c.$$phase||c.$apply())}),c.imgLoaded=function(e,t){c.pageination.viewItems[e].show=!0},c.setLh=function(){i.path("/grs/"+c.params.grs).replace()},c.navType=function(){var e=c.params.shatts.nav;return"both"===e||"buttons"===e},c.grsShTC=function(){return d.grsShTC(c.params.shatts.title,c.params.data.theme.carousel3d.crs3dThumbTEffect)},c.grsOnhv=function(){return d.grsOnhv(c.params.shatts.title)?"grsTOnhover":""},c.shVIc=function(e){return d.shVIc(c.pageination.viewItems[e])},c.grsShMC=function(){return d.grsShMC(c.params.shatts.title,c.params.data.theme.carousel3d.crs3dThumbTEffect)},c.shCarousel3d=function(){return 0<c.pageination.loadedCount},c.getImageSrc=function(e){var t=c.pageination.viewItems[e].indexes.page,e=c.pageination.viewItems[e].indexes.image,e=c.pageination.pagedItems[t][e];return p=c.params,e.thumbWidth=p.thumbWidth,e.thumbHeight=p.thumbHeight,d.getImageSource(e,"thumbnail")},c.CheckGrsHash=function(){var e=n.location.hash,t=c.params.grs,a=!1;if(-1!==e.indexOf("grs")){e=e.split("/");if(e[2]==t&&3<e.length){imageId=e.pop();for(var i=0;i<c.pageination.pagedItems[0].length;i++)if(c.pageination.pagedItems[0][i].id==imageId){a=!0;break}a?c.clickAction(i):c.clickAction("hash-"+imageId)}}},c.$watch(function(){return d.settingsReady},function(e,t){e&&a.getGalleryData(0,c.pageination.itemsPerPage,c.params.shatts.id,1,c.params.shatts.orderby,c.params.shatts.ordering,c.params.shatts.theme,c.params.shatts.view).then(function(e){if(d.log(e),c.pageination.gallExists=e.data.gallExists,c.params.data.theme.carousel3d=JSON.parse(e.data.theme.carousel3d),c.params.data.theme.lightbox=JSON.parse(e.data.theme.lightbox),c.pageination.pagedItems[0]=e.data.images,c.pageination.totalcount=parseInt(e.data.count),c.pageination.totalcount<=c.pageination.viewItemsCount&&(c.params.totalCountIsLess=!0,c.pageination.viewItemsCount=c.pageination.totalcount),c.pageination.pagesCount=Math.ceil(c.pageination.totalcount/c.pageination.itemsPerPage),c.pageination.loadedCount=0<c.pageination.pagesCount?1:0,c.pageination.gallExists){if(c.pageination.pagesCount<2)return c.pageination.loading=!1,a.Carousel3dPositioning(c.params,c.pageination),void c.CheckGrsHash();var t=Math.ceil(c.pageination.totalcount/c.pageination.itemsPerPage)-1;a.getGalleryData(t,c.pageination.itemsPerPage,c.params.shatts.id,0,c.params.shatts.orderby,c.params.shatts.ordering,c.params.shatts.theme,c.params.shatts.view).then(function(e){return c.pageination.pagedItems[t]=e.data.images,c.pageination.pagedItems[t].length>=Math.floor(c.pageination.viewItemsCount/2)?(c.pageination.loading=!1,a.Carousel3dPositioning(c.params,c.pageination),void c.CheckGrsHash()):void(2<c.pageination.pagesCount?a.getGalleryData(t-1,c.pageination.itemsPerPage,c.params.shatts.id,0,c.params.shatts.orderby,c.params.shatts.ordering,c.params.shatts.theme,c.params.shatts.view).then(function(e){c.pageination.pagedItems[t-1]=e.data.images,c.pageination.loading=!1,a.Carousel3dPositioning(c.params,c.pageination),c.CheckGrsHash()},function(e){d.log(e)}):(c.pageination.loading=!1,a.Carousel3dPositioning(c.params,c.pageination),c.CheckGrsHash()))},function(e){d.log(e)})}},function(e){d.log(e)})},!0)}}}]),grsApp.directive("grsThumbnail",["$filter","GrsFactory","GrsService","$window","$location",function(e,a,i,r,o){return{restrict:"E",transclude:!0,scope:{params:"="},templateUrl:i.getViewsTemplateUrl("grsThumbnail"),link:function(n,t,e){n.sortingOrder="id",n.reverse=!0,n.message={type:"success",show:!1,text:""},i.log(n.params),n.params.contHeight=50,n.params.contHeightFirstBinding=!1,n.params.loadedCount=0,n.pageination={pN:0,forGallery:!0,grs:n.params.grs,items:[],navView:n.params.shatts.pagination,gallery:n.params.shatts.id,currentPage:0,totalcount:-1,loadedCount:0,itemsPerPage:parseInt(n.params.shatts.imagesperpage),orderBy:n.params.shatts.orderby,ordering:n.params.shatts.ordering,pagedItems:[],scrolling:!1,loading:!0,positioning:function(){a.ThumbnailPositioning(n.params,this,"")},message:function(e,t,a){n.message.show=e,n.message.text=t,n.message.type=void 0!==a?a:"success"},checkScrolling:function(){return i.log("ekanq mas scrolling"),n.checkScrolling()}},n.clickAction=function(e,t){void 0!==t&&t.preventDefault(),n["clickAction"+n.params.shatts.clickaction](e)},n.clickActiondoNothing=function(){},n.clickActionopenLightbox=function(e){var t=n.params,a=n.pageination;n.setLh(),i.setPopObj({show:!0,grs:t.grs,gallId:t.shatts.id,shatts:t.shatts,theme:t.data.theme.lightbox,orderby:t.shatts.orderby,ordering:t.shatts.ordering,items:[],pI:a.pagedItems,cP:a.currentPage,pC:a.pagesCount,tC:a.totalcount,lC:a.loadedCount,index:e})},n.clickActionopenLink=function(e){i.link(n.pageination.pagedItems[n.pageination.currentPage][e],n.params.shatts.openlinktarget)},n.$on("resize::resize",function(){n.pageination.gallExists&&(n.pageination.positioning(),n.$$phase||n.$apply())}),n.$on("scroll::scroll",function(){var e,t,a;"scrolling"===n.pageination.navView&&(n.pageination.loading||(e=(a=jQuery("#grsGal"+n.params.grs)).offset().top,t=a.innerHeight(),(a=r.innerHeight)/100<r.pageYOffset+a-(e+t)?(n.pageination.scrolling=!0,i.log("thumb mek 10ic ancanq")):n.pageination.scrolling=!1,n.$$phase||n.$apply()))}),n.checkScrolling=function(){if("scrolling"===n.pageination.navView){var e=jQuery("html").innerHeight();if(r.innerHeight>=e||r.pageYOffset+r.innerHeight>e){e=n.pageination.scrolling||2;return e*e}return!1}},n.$watch(function(){var e;"scrolling"===n.pageination.navView&&(n.pageination.loading||(0!=(e=t.find(".grsImsCont").innerHeight())?Math.round(n.params.contHeight)===Math.round(e)?n.params.loadedCount!=n.pageination.loadedCount&&(n.params.loadedCount=n.pageination.loadedCount,n.pageination.scrolling=n.checkScrolling()):i.log("live height@ not set"):i.log("Height watcher , gallCont@ der live height chuni")))}),n.imgLoaded=function(e,t){n.pageination.pagedItems[n.pageination.currentPage][e].show=!0},n.setLh=function(){o.path("/grs/"+n.params.grs).replace()},n.polOn=function(e){return parseInt(n.params.shatts.polaroid)?e%3==0?"pol_0 pol":(e%3==1?"pol_1":"pol_2")+" pol":""},n.grsShTC=function(){return i.grsShTC(n.params.shatts.title,n.params.data.theme.thumbnail.thumbnailTEffect)},n.grsOnhv=function(){return i.grsOnhv(n.params.shatts.title)?"grsTOnhover":""},n.shVIc=function(e){return i.shVIc(n.pageination.pagedItems[n.pageination.currentPage][e])},n.grsShMC=function(){return i.grsShMC(n.params.shatts.title,n.params.data.theme.thumbnail.thumbnailTEffect)},n.getImageSrc=function(e){e=n.pageination.pagedItems[n.pageination.currentPage][e];return i.getImageSource(e,"thumbnail")},n.CheckGrsHash=function(){var e=r.location.hash,t=n.params.grs,a=!1;if(-1!==e.indexOf("grs")){e=e.split("/");if(e[2]==t&&3<e.length){imageId=e.pop();for(var i=0;i<n.pageination.pagedItems[0].length;i++)if(n.pageination.pagedItems[0][i].id==imageId){a=!0;break}a?n.clickAction(i):n.clickAction("hash-"+imageId)}}},n.$watch(function(){return i.settingsReady},function(e,t){e&&a.getGalleryData(0,n.pageination.itemsPerPage,n.params.shatts.id,1,n.params.shatts.orderby,n.params.shatts.ordering,n.params.shatts.theme,n.params.shatts.view).then(function(e){i.log(e),n.pageination.gallExists=e.data.gallExists,n.pageination.loading=!1,n.params.data.theme.thumbnail=JSON.parse(e.data.theme.thumbnail),n.params.data.theme.lightbox=JSON.parse(e.data.theme.lightbox),n.pageination.pagedItems[0]=e.data.images,n.pageination.totalcount=e.data.count,n.pageination.pagesCount=Math.ceil(n.pageination.totalcount/n.pageination.itemsPerPage),n.pageination.loadedCount=0<n.pageination.pagesCount?1:0,n.pageination.gallExists&&(n.pageination.positioning(),n.CheckGrsHash())},function(e){i.log(e)})},!0)}}}]),grsApp.directive("grsFilm",["$filter","GrsFactory","GrsService","$window","$location",function(e,a,p,n,i){return{restrict:"E",transclude:!0,scope:{params:"="},templateUrl:p.getViewsTemplateUrl("grsFilm"),link:function(l,e,t){l.sortingOrder="id",l.reverse=!0,l.message={type:"success",show:!1,text:""},l.params.contHeight=50,l.params.flp=0,l.params.contHeightFirstBinding=!1,l.params.loadedCount=0,l.params.scrollToThe="nothing",l.pageination={pN:0,forGallery:!0,grs:l.params.grs,items:[],navView:"scrolling",gallery:l.params.shatts.id,currentPage:0,totalcount:-1,loadedCount:0,itemsPerPage:parseInt(l.params.shatts.imagesperpage),orderBy:l.params.shatts.orderby,ordering:l.params.shatts.ordering,pagedItems:[],scrolling:!1,loading:!0,positioning:function(){a.FilmPositioning(l.params,this,l.moveFC)},message:function(e,t,a){l.message.show=e,l.message.text=t,l.message.type=angular.isUndefined(a)?"success":a},checkScrolling:function(){return p.log("ekanq mas scrolling"),l.checkScrolling()}},l.hideNav=function(){var e=l.params,t=l.pageination;return!(t.pagesCount>t.loadedCount)&&e.contWidth+-1*e.flp>=e.flWidth},l.moveLeft=function(e){void 0!==e&&e.preventDefault(),l.moveFC("left")},l.moveRight=function(e){void 0!==e&&e.preventDefault(),l.moveFC("right")},l.moveFC=function(e){if("nothing"!==e){var t,a=l.params.flp,i=l.params,n=i.data.theme.film,r=i.flWidth,o=i.contWidth,s=parseInt(i.shatts.width)+parseInt(n.fmThumbMargin)+2*(parseInt(n.fmThumbPadding)+("none"!==n.fmThumbBorderStyle?parseInt(n.fmThumbBorderWidth):0)),i=p.settings.filmImMoveCount,n=Math.floor(Math.floor(o/s)/2),g=n<i?0===n?1:n:i;if("left"===e){if(r<=o+-1*a)return l.pageination.scrolling=!0,void(l.params.scrollToThe="left");t=h(a-(r-(o+-1*a))%s,!1)}else if("right"===e){if(0===a)return;t=h(a+-1*a%s,!0)}l.params.flp=t,l.params.scrollToThe="nothing"}function h(e,t){var a=t?-1*parseInt(e/s):parseInt((r-(o+-1*e))/s);return 0<a&&(a=a<g?a:g,t?e+=a*s:e-=a*s),e}},"scroll"!==l.params.shatts.nav&&"both"!==l.params.shatts.nav||e.find(".grsFilm").bind("mousewheel DOMMouseScroll",function(e){var t=e.originalEvent.wheelDelta,a=e.originalEvent.deltaY||e.originalEvent.detail;angular.isUndefined(t)?angular.isUndefined(a)||(0<a?l.moveFC("left"):l.moveFC("right")):0<t?l.moveFC("right"):l.moveFC("left"),e.preventDefault(),l.$$phase||l.$apply()}),l.clickAction=function(e,t){void 0!==t&&t.preventDefault(),l["clickAction"+l.params.shatts.clickaction](e)},l.clickActiondoNothing=function(){},l.clickActionopenLightbox=function(e){var t=l.params,a=l.pageination;l.setLh(),p.setPopObj({show:!0,grs:t.grs,gallId:t.shatts.id,shatts:t.shatts,theme:t.data.theme.lightbox,orderby:t.shatts.orderby,ordering:t.shatts.ordering,items:[],pI:a.pagedItems,cP:a.currentPage,pC:a.pagesCount,tC:a.totalcount,lC:a.loadedCount,index:e})},l.clickActionopenLink=function(e){p.link(l.pageination.pagedItems[l.pageination.currentPage][e],l.params.shatts.openlinktarget)},l.$on("resize::resize",function(){l.pageination.gallExists&&(l.pageination.positioning(),l.$$phase||l.$apply())}),l.imgLoaded=function(e,t){l.pageination.pagedItems[l.pageination.currentPage][e].show=!0},l.setLh=function(){i.path("/grs/"+l.params.grs).replace()},l.navType=function(){var e=l.params.shatts.nav;return"both"===e||"buttons"===e},l.grsShTC=function(){return p.grsShTC(l.params.shatts.title,l.params.data.theme.film.fmThumbTEffect)},l.grsOnhv=function(){return p.grsOnhv(l.params.shatts.title)?"grsTOnhover":""},l.shVIc=function(e){return p.shVIc(l.pageination.pagedItems[l.pageination.currentPage][e])},l.grsShMC=function(){return p.grsShMC(l.params.shatts.title,l.params.data.theme.film.fmThumbTEffect)},l.shFilm=function(){return 0<l.pageination.loadedCount},l.getImageSrc=function(e){var t=l.pageination.pagedItems[l.pageination.currentPage][e],e=l.params;return t.thumbWidth=e.thumbWidth,t.thumbHeight=e.thumbHeight,p.getImageSource(t,"thumbnail")},l.CheckGrsHash=function(){var e=n.location.hash,t=l.params.grs,a=!1;if(-1!==e.indexOf("grs")){e=e.split("/");if(e[2]==t&&3<e.length){imageId=e.pop();for(var i=0;i<l.pageination.pagedItems[0].length;i++)if(l.pageination.pagedItems[0][i].id==imageId){a=!0;break}a?l.clickAction(i):l.clickAction("hash-"+imageId)}}},l.$watch(function(){return p.settingsReady},function(e,t){e&&a.getGalleryData(0,l.pageination.itemsPerPage,l.params.shatts.id,1,l.params.shatts.orderby,l.params.shatts.ordering,l.params.shatts.theme,l.params.shatts.view).then(function(e){p.log(e),l.pageination.gallExists=e.data.gallExists,l.pageination.loading=!1,l.params.data.theme.film=JSON.parse(e.data.theme.film),l.params.data.theme.lightbox=JSON.parse(e.data.theme.lightbox),l.pageination.pagedItems[0]=e.data.images,l.pageination.totalcount=e.data.count,l.pageination.pagesCount=Math.ceil(l.pageination.totalcount/l.pageination.itemsPerPage),l.pageination.loadedCount=0<l.pageination.pagesCount?1:0,l.pageination.gallExists&&(a.FilmPositioning(l.params,l.pageination),l.CheckGrsHash())},function(e){p.log(e)})},!0)}}}]),grsApp.directive("grsAlbum",["$filter","GrsFactory","GrsService","$window","$location",function(e,l,p,r,o){return{restrict:"E",transclude:!0,scope:{params:"="},templateUrl:p.getViewsTemplateUrl("grsAlbum"),link:function(h,a,e){h.message={type:"success",show:!1,text:""},h.grsHash=[],h.toUpperCaseFl=function(e){return p.toUpperCaseFl(e)},h.options={grsMainView:p.getViewsTemplateUrl("grsAlbum"+h.params.shatts.mainview),grsGalView:p.getViewsTemplateUrl("grs"+h.params.shatts.galview),albVerHor:"Thumbnail"!==h.params.shatts.mainview?h.toUpperCaseFl(h.params.shatts.masmostype):"",galVerHor:"Thumbnail"!==h.params.shatts.galview?h.toUpperCaseFl(h.params.shatts.galmasmostype):"",albumView:!0,albThRes:{},back:!1,eStack:[]},h.params.contHeight=50,h.params.contHeightFirstBinding=!1,h.params.loadedCount=0,h.params.albumView=h.options.albumView,h.messageF=function(e,t,a){h.message.show=e,h.message.text=t,h.message.type=angular.isUndefined(a)?"success":a},h.mainPageination={pN:0,forGallery:!1,grs:h.params.grs,items:[],navView:h.params.shatts.pagination,album:h.params.shatts.id,currentPage:0,totalcount:-1,loadedCount:0,itemsPerPage:parseInt(h.params.shatts.imagesperpage),orderBy:h.params.shatts.orderby,ordering:h.params.shatts.ordering,pagedItems:[],scrolling:!1,loading:!0,positioning:function(){l[h.params.shatts.mainview+h.options.albVerHor+"Positioning"](h.params,this,".grsAlbum")},message:h.messageF,checkScrolling:function(){return p.log("ekanq mas scrolling"),h.checkScrolling()}},h.pageination={pN:0,forGallery:!0,grs:h.params.grs,items:[],navView:h.params.shatts.pagination,gallery:0,currentPage:0,totalcount:-1,loadedCount:0,itemsPerPage:parseInt(h.params.shatts.imagesperpage),orderBy:h.params.shatts.galorderby,ordering:h.params.shatts.galordering,pagedItems:[],scrolling:!1,loading:!1,positioning:function(){l[h.params.shatts.galview+h.options.galVerHor+"Positioning"](h.params,this,"")},message:h.messageF,checkScrolling:function(){return p.log("ekanq album scrolling"),h.checkScrolling()}},h.$on("resize::resize",function(){(h.mainPageination.albExists||h.pageination.gallExists)&&(h.params.albumView=h.options.albumView,(h.options.albumView?h.mainPageination:h.pageination).positioning(),h.$$phase||h.$apply())}),h.$on("scroll::scroll",function(){var e,t,a,i,n;"scrolling"===h.mainPageination.navView&&((e=h.options.albumView?h.mainPageination:h.pageination).loading||(t=(n=jQuery("#grsGal"+h.params.grs)).offset().top,a=n.innerHeight(),i=r.innerHeight,n=r.pageYOffset+i,e.scrolling=i/10<n-(t+a),h.$$phase||h.$apply()))}),h.checkScrolling=function(){if("scrolling"===h.mainPageination.navView){var e=jQuery("html").innerHeight();if(r.innerHeight>=e||r.pageYOffset+r.innerHeight>e){e=(h.options.albumView?h.mainPageination:h.pageination).scrolling;return newVal=e||2,newVal*newVal}return!1}},h.$watch(function(){var e,t;"scrolling"===h.mainPageination.navView&&((e=h.options.albumView?h.mainPageination:h.pageination).loading||0!=(t=a.find(".grsImsCont").innerHeight())&&(Math.round(h.params.contHeight)!=Math.round(t)?p.log("live height@ not set"):h.params.loadedCount!=e.loadedCount?(h.params.loadedCount=e.loadedCount,e.scrolling=h.checkScrolling()):p.log("loaded - "+e.loadedCount)))}),h.scrollTop=function(){jQuery("html, body").animate({scrollTop:jQuery("#grsGal"+h.params.grs).offset().top-100},500)},h.grsShTC=function(){var e=h.options.albumView?"mainview":"galview",t=h.options.albumView?"title":"galtitle",a=h.params.shatts[e].toLowerCase()+"TEffect";return p.grsShTC(h.params.shatts[t],h.params.data.theme[h.params.shatts[e].toLowerCase()][a])},h.shVIc=function(e){return p.shVIc(h.pageination.pagedItems[h.pageination.currentPage][e])},h.grsShMC=function(){var e=h.options.albumView?"mainview":"galview",t=h.options.albumView?"title":"galtitle",a=h.params.shatts[e].toLowerCase()+"TEffect";return p.grsShMC(h.params.shatts[t],h.params.data.theme[h.params.shatts[e].toLowerCase()][a])},h.grsOnhv=function(){var e=h.options.albumView?"title":"galtitle";return p.grsOnhv(h.params.shatts[e])?"grsTOnhover":""},h.clickAction=function(e,t){void 0!==t&&t.preventDefault(),h["clickAction"+h.params.shatts.galclickaction](e)},h.clickActiondoNothing=function(){},h.clickActionopenLightbox=function(e){var t=h.params,a=h.pageination;h.setLh(),p.setPopObj({show:!0,grs:t.grs,gallId:a.gallery,shatts:t.shatts,theme:t.data.theme.lightbox,orderby:t.shatts.galorderby,ordering:t.shatts.galordering,items:[],pI:a.pagedItems,cP:a.currentPage,pC:a.pagesCount,tC:a.totalcount,lC:a.loadedCount,index:e})},h.clickActionopenLink=function(e){p.link(h.pageination.pagedItems[h.pageination.currentPage][e],h.params.shatts.galopenlinktarget)},h.imgLoaded=function(e,t){var a=h.options.albumView?"mainPageination":"pageination";h[a].pagedItems[h[a].currentPage][e].show=!0},h.setLh=function(){for(var e="/grs/"+h.params.grs,t=h.options.albumView,a=t?"album":"gallery",t=(t?h.mainPageination:h.pageination)[a],i=h.options.eStack,n=i.length,r=1;r<n;r++)e+="/album/"+i[r].albId;o.path(e=0!=n?e+"/"+a+"/"+t:"").replace()},h.CheckGrsHash=function(){var e=r.location.hash,t=h.params.grs;if(-1!==e.indexOf("grs")){var a=e.split("/");if(a[2]==t){for(var i=3,n=4;i<a.length;i+=2,n+=2)h.grsHash.push({type:a[i],id:a[n]});h.grsHash.length&&(h.grsHash=h.grsHash.reverse(),t=h.grsHash.pop(),h.grsEnter(!1,!1,t.id,t.type))}}},h.CheckGrsHashForPopup=function(){for(var e=h.grsHash.pop(),t=!1,a=0;a<h.pageination.pagedItems[0].length;a++)if(h.pageination.pagedItems[0][a].id==e.id){t=!0;break}t?h.clickAction(a):h.clickAction("hash-"+e.id)},h.grsEnter=function(e,t,a,i){t&&t.preventDefault();var n=h.mainPageination,r=h.pageination,o=n.album,s=n.currentPage,g=n.pagesCount,t=n.totalcount,i=i?"gallery"==i?"gal":"alb":n.pagedItems[n.currentPage][e].contentType,a=a||n.pagedItems[s][e].contentId;if(h.options.eStack.push({albId:o,cP:s,pC:g,tC:t}),n.loading=!0,h.params.loadedCount=0,"gal"===i)r.scrolling=!1,r.loadedCount=0,r.totalcount=-1,r.pagesCount=0,l.getGalleryData(0,r.itemsPerPage,a,1,h.params.shatts.galorderby,h.params.shatts.galordering,h.params.shatts.theme,h.params.shatts.galview).then(function(e){r.gallExists=e.data.gallExists,n.loading=!1,h.options.back=!0,h.options.albumView=!1,h.params.albumView=!1,r.gallery=a,h.params.data.theme[h.params.shatts.galview.toLowerCase()]=JSON.parse(e.data.theme[h.params.shatts.galview.toLowerCase()]),h.params.data.theme.lightbox=JSON.parse(e.data.theme.lightbox),r.pagedItems=[],r.currentPage=0,r.pagedItems[0]=e.data.images,r.totalcount=e.data.count,r.pagesCount=Math.ceil(r.totalcount/r.itemsPerPage),r.loadedCount=0<r.pagesCount?1:0,r.positioning(),h.grsHash.length?h.CheckGrsHashForPopup():h.setLh()},function(e){p.log(e)});else{if("alb"!==i)return void p.log("Something went wrong.");n.scrolling=!1,n.loadedCount=0,n.totalcount=-1,n.pagesCount=0,l.getAlbumData(0,n.itemsPerPage,a,1,h.params.shatts.orderby,h.params.shatts.ordering,h.params.shatts.theme,h.params.shatts.mainview).then(function(e){n.albExists=e.data.albExists,n.loading=!1,h.options.back=!0,n.album=a,h.params.data.theme[h.params.shatts.mainview.toLowerCase()]=JSON.parse(e.data.theme[h.params.shatts.mainview.toLowerCase()]),h.params.data.theme.lightbox=JSON.parse(e.data.theme.lightbox),n.pagedItems=[],n.currentPage=0,n.pagedItems[0]=e.data.content,n.totalcount=e.data.count,n.pagesCount=Math.ceil(n.totalcount/n.itemsPerPage),n.loadedCount=0<n.pagesCount?1:0,p.log("mtanq album "+n.loadedCount),n.positioning(),h.grsHash.length?(e=h.grsHash.pop(),h.grsEnter(!1,!1,e.id,e.type)):h.setLh()},function(e){p.log(e)})}h.scrollTop()},h.grsBack=function(e){e.preventDefault();var t,a=h.options.eStack.pop();angular.isUndefined(a)||(e=h.options.albumView,t=e?h.mainPageination:h.pageination,e?t.album:t.gallery,t.loading=!0,h.mainPageination.album=a.albId,h.mainPageination.scrolling=!1,h.mainPageination.loadedCount=0,h.mainPageination.totalcount=-1,h.mainPageination.pagesCount=0,h.params.loadedCount=0,l.getAlbumData(a.cP,h.mainPageination.itemsPerPage,a.albId,0,h.params.shatts.orderby,h.params.shatts.ordering).then(function(e){h.mainPageination.albExists=e.data.albExists,t.loading=!1,0==h.options.eStack.length&&(h.options.back=!1),h.options.albumView=!0,h.params.albumView=!0,h.params.data.theme=h.options.albThRes,h.mainPageination.pagedItems=[],h.mainPageination.pagedItems[a.cP]=e.data.content,h.mainPageination.currentPage=a.cP,h.mainPageination.totalcount=a.tC,h.mainPageination.pagesCount=a.pC,h.mainPageination.loadedCount=0<h.mainPageination.pagesCount?1:0,h.mainPageination.positioning(),h.scrollTop(),h.setLh()},function(e){p.log(e)}))},h.getImageSrc=function(e){var t=h.options.albumView,a=t?"mainPageination":"pageination",i=(t?h.params.shatts.mainview:h.params.shatts.galview).toLowerCase(),e=h[a].pagedItems[h[a].currentPage][e];return"grsnopv"===e.name&&""===e.path?p.imagesDir+e.name+e.type:t?p.uploaderUrl+e.path+p.getImageVer(e.thumbWidth,e.thumbHeight,i)+e.name+e.type:p.getImageSource(e,i)},h.getTrans=p.getTrans,h.$watch(function(){return p.settingsReady},function(e,t){e&&l.getAlbumData(0,h.mainPageination.itemsPerPage,h.params.shatts.id,1,h.params.shatts.orderby,h.params.shatts.ordering,h.params.shatts.theme,h.params.shatts.mainview).then(function(e){h.mainPageination.albExists=e.data.albExists,h.mainPageination.loading=!1,h.params.data.theme[h.params.shatts.mainview.toLowerCase()]=JSON.parse(e.data.theme[h.params.shatts.mainview.toLowerCase()]),h.params.data.theme.lightbox=JSON.parse(e.data.theme.lightbox),h.options.albThRes=h.params.data.theme,h.mainPageination.album=h.params.shatts.id,h.mainPageination.pagedItems[0]=e.data.content,h.mainPageination.totalcount=e.data.count,h.mainPageination.pagesCount=Math.ceil(h.mainPageination.totalcount/h.mainPageination.itemsPerPage),h.mainPageination.loadedCount=0<h.mainPageination.pagesCount?1:0,h.mainPageination.albExists&&(h.mainPageination.positioning(),h.CheckGrsHash())},function(e){p.log(e)})},!0)}}}]),grsApp.directive("grsNav",["$filter","$compile","$parse","GrsFactory","GrsService",function(a,e,t,n,r){return{restrict:"E",transclude:!0,scope:{pageInation:"="},template:'<div ng-include="options.grsNavView" class="grsNavInc"></div>',link:function(i,e,t){i.options={showNav:!1},i.$watch("pageInation.navView",function(){i.options.grsNavView="scrolling"!==i.pageInation.navView&&"none"!==i.pageInation.navView?r.getViewsTemplateUrl("grsPagenav"+i.pageInation.navView):""},!0),i.$watch("pageInation.totalcount",function(){var e=0==i.pageInation.totalcount,t=i.pageInation.forGallery?i.getTrans("text_077"):i.getTrans("text_078"),t=i.pageInation.forGallery&&!i.pageInation.gallExists?i.getTrans("text_079"):t,t=i.pageInation.forGallery||i.pageInation.albExists?t:i.getTrans("text_080");i.pageInation.message(e,t,"error")},!0),i.$watch("pageInation.scrolling",function(){r.log("ekanq scrollingi watcher grsNavum"),r.log("watcher-i arjeq@ "+i.pageInation.scrolling),i.pageInation.scrolling&&(r.log("ekanq scrolling loadmore"),i.loadMore())},!0);i.$watch("pageInation.pagesCount",function(){void 0!==i.pageInation.pagedItems&&void 0!==i.pageInation.pagesCount&&i.showNavF()}),i.$watch("pageInation.pN",function(){0!=i.pageInation.pN&&(i.checkPage(i.pageInation.pN),r.log(i.pageInation.pN+" page is loading!"))},!0),i.search=function(){i.pageInation.filteredItems=a("filter")(i.pageInation.items,function(e){for(var t in e)if(a=e[t],!(t=i.query)||-1!==a.toLowerCase().indexOf(t.toLowerCase()))return!0;var a;return!1}),i.pageInation.currentPage=0,i.groupToPages()},i.groupToPages=function(){i.pageInation.pagedItems=[];for(var e=0;e<i.pageInation.filteredItems.length;e++)e%i.pageInation.itemsPerPage==0?i.pageInation.pagedItems[Math.floor(e/i.pageInation.itemsPerPage)]=[i.pageInation.filteredItems[e]]:i.pageInation.pagedItems[Math.floor(e/i.pageInation.itemsPerPage)].push(i.pageInation.filteredItems[e])},i.range=function(e,t){var a=[];t||(t=e,e=0);for(var i=e;i<t;i++)a.push(i);return a},i.getForGallery=function(t){i.pageInation.loading=!0,n.getGalleryData(t,i.pageInation.itemsPerPage,i.pageInation.gallery,0,i.pageInation.orderBy,i.pageInation.ordering).then(function(e){i.pageInation.loading=!1,i.pageInation.pagedItems[t]=e.data.images,i.pageInation.currentPage=t,i.pageInation.positioning()},function(e){r.log(e)})},i.getForAlbum=function(t){i.pageInation.loading=!0,n.getAlbumData(t,i.pageInation.itemsPerPage,i.pageInation.album,0,i.pageInation.orderBy,i.pageInation.ordering).then(function(e){i.pageInation.loading=!1,i.pageInation.pagedItems[t]=e.data.content,i.pageInation.currentPage=t,i.pageInation.positioning()},function(e){r.log(e)})},i.checkPage=function(e){void 0===i.pageInation.pagedItems[e]?void 0!==i.pageInation.forGallery&&i.pageInation.forGallery?i.getForGallery(e):void 0===i.pageInation.forGallery||i.pageInation.forGallery?r.log("Something went wrong."):i.getForAlbum(e):(i.pageInation.currentPage=e,i.pageInation.positioning()),jQuery("html, body").animate({scrollTop:jQuery("#grsGal"+i.pageInation.grs).offset().top-100},500)},i.prevPage=function(){var e;0<i.pageInation.currentPage&&(e=i.pageInation.currentPage,i.checkPage(--e))},i.loadMore=function(e){void 0!==e&&e.preventDefault(),i.pageInation.loading?r.log("Loading in progress"):i.pageInation.loadedCount!=i.pageInation.pagesCount&&0!=i.pageInation.pagesCount?angular.isUndefined(i.pageInation.pagedItems[0])?r.log("Problem with first load"):void 0!==i.pageInation.forGallery&&i.pageInation.forGallery?(i.pageInation.loading=!0,i.pageInation.scrolling=!1,n.getGalleryData(i.pageInation.loadedCount,i.pageInation.itemsPerPage,i.pageInation.gallery,0,i.pageInation.orderBy,i.pageInation.ordering).then(function(e){i.pageInation.loading=!1,i.pageInation.loadedCount+=1,i.pageInation.pagedItems[0]=i.pageInation.pagedItems[0].concat(e.data.images),i.pageInation.positioning(),i.showNavF()},function(e){r.log(e)})):void 0===i.pageInation.forGallery||i.pageInation.forGallery||(i.pageInation.loading=!0,i.pageInation.scrolling=!1,n.getAlbumData(i.pageInation.loadedCount,i.pageInation.itemsPerPage,i.pageInation.album,0,i.pageInation.orderBy,i.pageInation.ordering).then(function(e){i.pageInation.loading=!1,i.pageInation.loadedCount+=1,i.pageInation.pagedItems[0]=i.pageInation.pagedItems[0].concat(e.data.content),i.pageInation.positioning(),i.showNavF()},function(e){r.log(e)})):r.log("Already all is loaded")},i.nextPage=function(){var e;i.pageInation.currentPage<i.pageInation.pagesCount-1&&(e=i.pageInation.currentPage,i.checkPage(++e))},i.lastPage=function(){var e;i.pageInation.currentPage<i.pageInation.pagesCount-1&&(e=i.pageInation.pagesCount-1,i.checkPage(e))},i.firstPage=function(){0<i.pageInation.currentPage&&i.checkPage(0)},i.setPage=function(){var e=this.n;i.checkPage(e)},i.showNavF=function(){r.log("loaded count - "+i.pageInation.loadedCount),r.log("pagesCount count - "+i.pageInation.pagesCount),"numbers"!=i.pageInation.navView?i.options.showNav=i.pageInation.loadedCount!=i.pageInation.pagesCount&&0!=i.pageInation.pagesCount:i.options.showNav=1!=i.pageInation.pagesCount&&0!=i.pageInation.pagesCount},i.getTrans=r.getTrans}}}]),grsApp.factory("GrsFactory",["$http","$q","GrsService",function(g,h,W){return{getGalleryData:function(e,t,a,i,n,r,o,s){return g({method:"POST",url:scriptData.grsAjaxUrl,data:jQuery.param({action:"grsGalleryAjax",grsAction:"getGalleryData",id:a,start:e,count:t,orderBy:n,ordering:r,firstRequest:i,theme:i?o:0,view:i?s:""}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){return h.resolve(e)},function(e){return W.log("errr"),h.reject(e)})},getAlbumData:function(e,t,a,i,n,r,o,s){return g({method:"POST",url:scriptData.grsAjaxUrl,data:jQuery.param({action:"grsGalleryAjax",grsAction:"getAlbumData",id:a,start:e,count:t,orderBy:n,ordering:r,firstRequest:i,theme:i?o:0,view:i?s:""}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){return h.resolve(e)},function(e){return W.log("errr"),h.reject(e)})},getPopupData:function(e,t,a,i,n){return g({method:"POST",url:scriptData.grsAjaxUrl,data:jQuery.param({action:"grsGalleryAjax",grsAction:"getPopupData",id:e,offsets:t,perPage:a,orderBy:i,ordering:n}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){return h.resolve(e)},function(e){return W.log("errr"),h.reject(e)})},getSettings:function(){return g({method:"POST",url:scriptData.grsAjaxUrl,data:jQuery.param({action:"grsGalleryAjax",grsAction:"getSettingsForF"}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){return h.resolve(e)},function(e){return W.log("errr"),h.reject(e)})},getEffects:function(){return g.get(W.effectsJsonUrl).then(function(e){return h.resolve(e)},function(e){return W.log("errr"),h.reject(e)})},getImgComm:function(e,t){return g({method:"POST",url:scriptData.grsAjaxUrl,data:jQuery.param({action:"grsGalleryAjax",grsAction:"showComments",id:e,gallId:t}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){return h.resolve(e)},function(e){return W.log("errr"),h.reject(e)})},postIc:function(e,t,a,i,n,r){return g({method:"POST",url:scriptData.grsAjaxUrl,data:jQuery.param({action:"grsGalleryAjax",grsAction:"comment",name:e,captchaCode:t,email:a,comment:i,imageId:n,galId:r}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){return h.resolve(e)},function(e){return W.log("errr"),h.reject(e)})},reloadCap:function(e,t,a){return g({method:"POST",url:scriptData.grsAjaxUrl,data:jQuery.param({action:"grsGalleryAjax",grsAction:"reloadCaptcha"}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){return h.resolve(e)},function(e){return W.log("errr"),h.reject(e)})},ThumbnailPositioning:function(e,t,a){var i=jQuery("#grsGal"+e.grs).parent().width()*((void 0===e.albumView||void 0!==e.albumView&&e.albumView?parseInt(e.shatts.contwidth):parseInt(e.shatts.galcontwidth))/100),n=(m=void 0===e.albumView||void 0!==e.albumView&&e.albumView?parseInt(e.shatts.width):parseInt(e.shatts.galwidth))==(d=void 0===e.albumView||void 0!==e.albumView&&e.albumView?parseInt(e.shatts.height):parseInt(e.shatts.galheight)),r=0,o=e.data.theme.thumbnail,s=parseInt(o.thumbnailmargin),g="none"!=o.thumbnailBorderStyle?2*parseInt(o.thumbnailBorderWidth):0,h=[],l=[];g+=2*parseInt(o.thumbnailpadding);var p=Math.round(parseInt(i+s)/(m+g+s)),m=(i+s-(p=t.pagedItems[t.currentPage].length<(p=p<1?1:p)?t.pagedItems[t.currentPage].length:p)*(g+s))/p;if(0!=p&&0!=t.pagedItems[t.currentPage].length){for(var c=0;c<p;c++)l[c]=[],h[c]=0;for(var d=n?m:d,u=0;u<t.pagedItems[t.currentPage].length;u++){t.pagedItems[t.currentPage][u].thumbHeight=d,t.pagedItems[t.currentPage][u].thumbWidth=m;var f=Math.min.apply(Math,h),f=h.indexOf(f);h[f]+=d+g+s,l[f].push(t.pagedItems[t.currentPage][u])}var n=Math.max.apply(Math,h),n=h.indexOf(n),v=0;r+=h[n]-s;for(u=0;u<l.length;u++){for(var w=0,c=0;c<l[u].length;c++)l[u][c].left=v,l[u][c].top=w,w+=l[u][c].thumbHeight+g+s;v+=m+g+s}e.contWidth=v-s,e.contHeight=r}else e.contHeight=50},FilmPositioning:function(e,t,a){var i=jQuery("#grsGal"+e.grs).parent().width(),n=void 0===e.albumView||void 0!==e.albumView&&e.albumView?parseInt(e.shatts.contwidth):parseInt(e.shatts.galcontwidth),r=void 0===e.albumView||void 0!==e.albumView&&e.albumView?parseInt(e.shatts.width):parseInt(e.shatts.galwidth),o=void 0===e.albumView||void 0!==e.albumView&&e.albumView?parseInt(e.shatts.height):parseInt(e.shatts.galheight),s=e.data.theme.film,g=parseInt(s.fmThumbMargin),h=parseInt(s.fmMargin),l="none"!==s.fmThumbBorderStyle?parseInt(s.fmThumbBorderWidth):0,s=parseInt(s.fmThumbPadding);e.contWidth=i*(n/100),e.thumbWidth=r,e.thumbHeight=o,e.contHeight=o+2*(h+s+l),e.flHeight=o+2*(s+l),e.flWidth=t.pagedItems[t.currentPage].length*(r+g+2*(s+l))+g,a&&a(e.scrollToThe)},Carousel3dPositioning:function(e,t,a,i){var n=jQuery("#grsGal"+e.grs).parent().width(),r=void 0===e.albumView||void 0!==e.albumView&&e.albumView?parseInt(e.shatts.contwidth):parseInt(e.shatts.galcontwidth),o=void 0===e.albumView||void 0!==e.albumView&&e.albumView?parseInt(e.shatts.width):parseInt(e.shatts.galwidth),s=void 0===e.albumView||void 0!==e.albumView&&e.albumView?parseInt(e.shatts.height):parseInt(e.shatts.galheight),g=e.data.theme.carousel3d,h=("none"!==g.crs3dThumbBorderStyle&&parseInt(g.crs3dThumbBorderWidth),parseInt(g.crs3dThumbPadding),parseInt(g.crs3dThumbBoxshadowThdVal)?7:0),l=700<n?1:600<n?.9:490<n?.8:420<n?.7:360<n?.6:.5;n*=r/100;var p=l*parseFloat(e.shatts.minscale),m=l*parseFloat(e.shatts.maxscale),c=parseFloat(e.shatts.rightdepth),d=parseFloat(e.shatts.leftdepth),u=t.getRightDoorIndex(),f=t.getLeftDoorIndex();if(!e.firstViewIsDone){for(var v=[],w=({page:"object"==typeof v[u]&&"indexes"in v[u]?v[u].indexes.page:Math.floor(u/t.itemsPerPage),image:"object"==typeof v[u]&&"indexes"in v[u]?v[u].indexes.image:u%t.itemsPerPage}),I=u,b=0;b<t.viewItemsCount;b++,I=I-1<0?t.viewItemsCount-1:I-1){if(void 0===t.pagedItems[w.page]||void 0===t.pagedItems[w.page][w.image])return void(t.pN=w.page);v[I]=t.pagedItems[w.page][w.image],v[I].indexes={page:w.page,image:w.image},w=t.getPrevImgIndexes(w.page,w.image)}t.viewItems=v}var C,y,P,x,S,k,A,T,E,M,H,V,F,L,$,G,W=t.viewItems,D=W.length,g=(p+m)/2,N=(n-g*(o+2*h))/2,O=D,U=2*Math.PI/D,R=-Math.PI/2,r=Math.atan((p-m)*(o+2*h)/(4*N)),l=p+(1-Math.sin(r))*(m-p)/2,j=(2*(N-=N*Math.cos(r)+l*(o+2*h)/2-(N+g*(o+2*h)/2))+o-n)/2,z=0;d*c<0?(M=(E=((k=1)-p)*s/2)+p*s,V=(H=(1-m)*s/2+2*N*(0<d?d:c))+m*s,L=(F=(1-p)*s/2+(S=2*N*Math.abs(d-c)))+p*s,$=Math.abs(Math.max(M,V,L)-Math.min(E,H,F))+2*h,z=Math.min(E,H,F)-h):0<d*c&&0<d?(A=(k=2)*N*Math.abs(d-c),M=(E=(1-p)*s/2)+p*s,V=(H=(1-m)*s/2+2*N*(T=Math.max(d,c)))+m*s,L=(F=(1-p)*s/2+A)+p*s,$=Math.abs(Math.max(M,V,L)-Math.min(E,H,F))+2*h,z=Math.min(E,H,F)-h):0<d*c&&d<0?(k=3,A=2*N*Math.abs(d-c),M=(E=(1-p)*s/2+(g=2*N*-(T=Math.max(d,c))))+p*s,V=(H=(1-m)*s/2)+m*s,L=(F=(1-p)*s/2+A+g)+p*s,$=Math.abs(Math.max(M,V,L)-Math.min(E,H,F))+2*h,z=Math.min(E,H,F)-h-g):d*c==0&&(k=4,L=0<d||0<c?(M=(E=(1-p)*s/2)+p*s,V=(H=(1-m)*s/2+(S=2*N*(0<d?d:c)))+m*s,(F=(1-p)*s/2+S)+p*s):d<0||c<0?(M=(E=(1-p)*s/2)+p*s,V=(H=(1-m)*s/2)+m*s,(F=(1-p)*s/2+(S=2*N*-(d<0?d:c)))+p*s):(S=0,M=(E=(1-p)*s/2)+p*s,V=(H=(1-m)*s/2)+m*s,(F=(1-p)*s/2)+p*s),$=Math.abs(Math.max(M,V,L)-Math.min(E,H,F))+2*h,z=Math.min(E,H,F)-h);var B,_,q=Math.round(Math.PI/2*1e6)/1e6;for(I=0;I<D;I++){switch(e.firstViewIsDone&&(R=W[I].params.alpha),G=Math.round(1e6*R)/1e6<q?c:d,C=N*(1+Math.cos(R))-j,y=(P=N*(1-Math.sin(R)))*G-z,k){case 1:y+=G<0?S:0;break;case 2:case 3:y+=G<T?A:0;break;case 4:y+=(0==G&&0<Math.max(d,c)?S:0)+(G<0?S:0)}x=p+P*(m-p)/(2*N),e.firstViewIsDone?W[I].params={x:C,y:y,z:P,scale:x,alpha:W[I].params.alpha,zIndex:W[I].params.zIndex}:(W[I].params={x:C,y:y,z:P,scale:x,alpha:R,zIndex:0},I<=D/2?I<1?W[I].params.zIndex=O--:(W[I].params.zIndex=O,O-=2):D-I in W&&(W[I].params.zIndex=W[D-I].params.zIndex-1)),W[I].picCSS={width:o+"px",height:s+"px","z-index":W[I].params.zIndex,"-webkit-transition":"all 0.3s",transition:"all 0.3s","-webkit-transform:":"translate3d("+W[I].params.x+"px,"+W[I].params.y+"px,"+W[I].params.z+"px) scale("+W[I].params.scale+")","-ms-transform:":"translate3d("+W[I].params.x+"px,"+W[I].params.y+"px,"+W[I].params.z+"px) scale("+W[I].params.scale+")","-o-transform:":"translate3d("+W[I].params.x+"px,"+W[I].params.y+"px,"+W[I].params.z+"px) scale("+W[I].params.scale+")",transform:"translate3d("+W[I].params.x+"px,"+W[I].params.y+"px,"+W[I].params.z+"px) scale("+W[I].params.scale+")"},e.firstViewIsDone||(R+=U)}if(e.crs3dWidth=n,e.crs3dHeight=$,e.contWidth=n,e.contHeight=$,e.thumbWidth=o,e.thumbHeight=s,e.firstViewIsDone)B=u,_=f;else{var Q,Y,J=t.getNextImgIndexes(W[u].indexes.page,W[u].indexes.image),X=t.getPrevImgIndexes(W[f].indexes.page,W[f].indexes.image);if(void 0===t.pagedItems[J.page]||void 0===t.pagedItems[J.page][J.image])return void(t.pN=J.page);if(void 0===t.pagedItems[X.page]||void 0===t.pagedItems[X.page][X.image])return void(t.pN=X.page);_=(B=u+1)+1,t.totalcount==t.viewItemsCount+1||e.totalCountIsLess?((Q=angular.copy(t.pagedItems[J.page][J.image])).nId=(new Date).getUTCMilliseconds(),(Y=angular.copy(t.pagedItems[X.page][X.image])).nId=(new Date).getUTCMilliseconds()):(Q=t.pagedItems[J.page][J.image],Y=t.pagedItems[X.page][X.image]),W.splice(B,0,Q),W.splice(_,0,Y)}switch(Y=Math.PI/2-(D+1)%2*U/2,C=N*(1+Math.cos(Y))-j,P=N*(1-Math.sin(Y)),k){case 1:y=P*d+(d<0?S:0)-z;break;case 2:case 3:y=P*d+(d<T?A:0)-z;break;case 4:y=P*d-z,(d<0||0<c)&&(y+=S)}switch(W[_].params={x:C,y:y,z:P,scale:0,alpha:Y,zIndex:0},W[_].picCSS={width:o+"px",height:s+"px","z-index":"0","-webkit-transition":"all 0.3s",transition:"all 0.3s","-webkit-transform:":"translate3d("+C+"px,"+y+"px,"+P+"px) scale(0.000001)","-ms-transform:":"translate3d("+C+"px,"+y+"px,"+P+"px) scale(0.000001)","-o-transform:":"translate3d("+C+"px,"+y+"px,"+P+"px) scale(0.000001)",transform:"translate3d("+C+"px,"+y+"px,"+P+"px) scale(0.000001)"},k){case 1:y=P*c+(c<0?S:0)-z;break;case 2:case 3:y=P*c+(c<T?A:0)-z;break;case 4:y=P*c-z,(c<0||0<d)&&(y+=S)}W[B].params={x:C,y:y,z:P,scale:0,alpha:Y,zIndex:0},W[B].picCSS={width:o+"px",height:s+"px","z-index":"0","-webkit-transition":"all 0.3s",transition:"all 0.3s","-webkit-transform:":"translate3d("+C+"px,"+y+"px,"+P+"px) scale(0.000001)","-moz-transform:":"translate3d("+C+"px,"+y+"px,"+P+"px) scale(0.000001)","-ms-transform:":"translate3d("+C+"px,"+y+"px,"+P+"px) scale(0.000001)","-o-transform:":"translate3d("+C+"px,"+y+"px,"+P+"px) scale(0.000001)",transform:"translate3d("+C+"px,"+y+"px,"+P+"px) scale(0.000001)"},e.firstViewIsDone||(W[B].indexes={page:J.page,image:J.image},W[_].indexes={page:X.page,image:X.image},t.viewItemsCount+=2),e.firstViewIsDone=!0,a&&a(e.clickedImageIndexes.local,!0),i&&-1==e.clickedImageIndexes.local&&i(e.scrollToThe)},MasonryVerPositioning:function(e,t,a){var i=jQuery("#grsGal"+e.grs).parent().width()*((void 0===e.albumView||void 0!==e.albumView&&e.albumView?parseInt(e.shatts.contwidth):parseInt(e.shatts.galcontwidth))/100),n=void 0===e.albumView||void 0!==e.albumView&&e.albumView?parseInt(e.shatts.width):parseInt(e.shatts.galwidth),r=0,o=e.data.theme.masonry,s=parseInt(o.masonrymargin),g="none"!=o.masonryBorderStyle?2*parseInt(o.masonryBorderWidth):0,h=[],l=[];g+=2*parseInt(o.masonryPadding);var p=Math.round(parseInt(i+s)/(n+g+s)),n=(i+s-(p=t.pagedItems[t.currentPage].length<p?t.pagedItems[t.currentPage].length:p)*(g+s))/p;if(0!=p){for(var m=0;m<p;m++)l[m]=[],h[m]=0;for(var c=0;c<t.pagedItems[t.currentPage].length;c++){var d=n*parseInt(t.pagedItems[t.currentPage][c].height)/parseInt(t.pagedItems[t.currentPage][c].width);t.pagedItems[t.currentPage][c].thumbHeight=d,t.pagedItems[t.currentPage][c].thumbWidth=n;var u=Math.min.apply(Math,h),u=h.indexOf(u);h[u]+=d+g+s,l[u].push(t.pagedItems[t.currentPage][c])}o=Math.max.apply(Math,h),o=h.indexOf(o);r+=h[o]-s;for(var f=0,c=0;c<l.length;c++){for(var v=0,m=0;m<l[c].length;m++)l[c][m].left=f,l[c][m].top=v,v+=l[c][m].thumbHeight+g+s;f+=n+g+s}e.contWidth=f-s,e.contHeight=r}else e.contHeight=50},MasonryHorPositioning:function(e,t,a){var i,n=jQuery("#grsGal"+e.grs).parent().width()*((void 0===e.albumView||void 0!==e.albumView&&e.albumView?parseInt(e.shatts.contwidth):parseInt(e.shatts.galcontwidth))/100),r=void 0===e.albumView||void 0!==e.albumView&&e.albumView?parseInt(e.shatts.height):parseInt(e.shatts.galheight),o=e.data.theme.masonry,s=parseInt(o.masonrymargin),g="none"!=o.masonryBorderStyle?2*parseInt(o.masonryBorderWidth):0,h=[];g+=2*parseInt(o.masonryPadding);for(var l=0,p=0,m=[],c=0;c<t.pagedItems[t.currentPage].length;c++){var d=parseInt(t.pagedItems[t.currentPage][c].height),d=r*(parseInt(t.pagedItems[t.currentPage][c].width)/d);t.pagedItems[t.currentPage][c].thumbHeight=r,1<(l+=(t.pagedItems[t.currentPage][c].thumbWidth=d)+(0==c?g:s+g))/n?(0!=c&&h.push(m),(m=[]).push(t.pagedItems[t.currentPage][c]),l=d+g):m.push(t.pagedItems[t.currentPage][c])}if(h.push(m),0!=h.length){for(var u=0,c=0;c<h.length;c++){for(var f=0,p=0;p<h[c].length;p++)h[c][p].left=f,h[c][p].top=u,f+=h[c][p].thumbWidth+s+g;u+=r+s+g}i=u,e.contWidth=n,e.contHeight=i}else e.contHeight=50},MosaicVerPositioning:function(e,t,a){var i,n=jQuery("#grsGal"+e.grs).parent().width()*((void 0===e.albumView||void 0!==e.albumView&&e.albumView?parseInt(e.shatts.contwidth):parseInt(e.shatts.galcontwidth))/100),r=void 0===e.albumView||void 0!==e.albumView&&e.albumView?parseInt(e.shatts.width):parseInt(e.shatts.galwidth),o=e.data.theme.mosaic,s=parseInt(o.mosaicMargin),g="none"!=o.mosaicBorderStyle?2*parseInt(o.mosaicBorderWidth):0,h=[],l=[],p=[],m=[],c=1,d=0;g+=2*parseInt(o.mosaicPadding);var u=Math.round(parseInt(n+s)/(r+g+s));if(0!=(u=t.pagedItems[t.currentPage].length<u?t.pagedItems[t.currentPage].length:u)){for(var f=0;f<u;f++)h[f]=[],l[f]=0;for(var v=0;v<t.pagedItems[t.currentPage].length;v++){var w=r*(x=parseInt(t.pagedItems[t.currentPage][v].height))/(S=parseInt(t.pagedItems[t.currentPage][v].width));t.pagedItems[t.currentPage][v].thumbHeight=w,t.pagedItems[t.currentPage][v].thumbWidth=r;var I=Math.min.apply(Math,l),I=l.indexOf(I);l[I]+=w+g+s,h[I].push(t.pagedItems[t.currentPage][v])}for(v=0;v<h.length;v++)for(f=m[v]=0;f<h[v].length;f++)m[v]+=h[v][f].thumbHeight/h[v][f].thumbWidth;for(var b=h[0].length,o=h.length,v=1;v<h.length;v++){var C=h[v].length;c+=m[0]/m[v],d+=(b*g+(b-1)*s-(C*g+(C-1)*s))/m[v]}p[0]=(n-(o*g+(o-1)*s)-d)/c;for(v=1;v<m.length;v++){C=h[v].length;p[v]=(p[0]*m[0]+b*g+(b-1)*s-(C*g+(C-1)*s))/m[v]}for(var y=0,v=0;v<h.length;v++){for(var P=0,f=0;f<h[v].length;f++){var x=parseInt(h[v][f].height),S=parseInt(h[v][f].width),w=p[v]*x/S;h[v][f].thumbWidth=p[v],h[v][f].thumbHeight=w,h[v][f].left=y,h[v][f].top=P,P+=w+g+s}y+=p[v]+g+s}i=P-s,e.contWidth=n,e.contHeight=i}else e.contHeight=50},MosaicHorPositioning:function(e,t,a){var i,n,r=jQuery("#grsGal"+e.grs).parent().width()*((void 0===e.albumView||void 0!==e.albumView&&e.albumView?parseInt(e.shatts.contwidth):parseInt(e.shatts.galcontwidth))/100),o=void 0===e.albumView||void 0!==e.albumView&&e.albumView?parseInt(e.shatts.height):parseInt(e.shatts.galheight),s=e.data.theme.mosaic,g=parseInt(s.mosaicMargin),h="none"!=s.mosaicBorderStyle?2*parseInt(s.mosaicBorderWidth):0,s=2*parseInt(s.mosaicPadding),l=(parseInt(e.shatts.contwidth),[]),p=[];h+=s;for(var m=0,c=0,d=[],u=0;u<t.pagedItems[t.currentPage].length;u++){var f=parseInt(t.pagedItems[t.currentPage][u].height),f=o*(parseInt(t.pagedItems[t.currentPage][u].width)/f);t.pagedItems[t.currentPage][u].thumbHeight=o,1<(m+=(t.pagedItems[t.currentPage][u].thumbWidth=f)+(0==u?h:g+h))/r&&u!=t.pagedItems[t.currentPage].length-1?(0!=u&&l.push(d),(d=[]).push(t.pagedItems[t.currentPage][u]),m=f+h):d.push(t.pagedItems[t.currentPage][u])}if(l.push(d),0!=(n=l.length)){if(1<n){if(s=l[n-1],nearLast=l[n-2],2<=nearLast.length/s.length)for(;0!=l[n-1].length;)l[n-2].push(l[n-1].pop());0==l[n-1].length&&l.pop()}for(u=0;u<l.length;u++){for(var v=0,c=0;c<l[u].length;c++)v+=l[u][c].thumbWidth/l[u][c].thumbHeight;p.push((r-((c-1)*g+c*h))/v)}for(var w=0,u=0;u<l.length;u++){for(var I=0,c=0;c<l[u].length;c++){var b=p[u]*(l[u][c].width/l[u][c].height);l[u][c].thumbWidth=b,l[u][c].thumbHeight=p[u],l[u][c].left=I,l[u][c].top=w,I+=b+g+h}w+=p[u]+g+h}i=w,e.contWidth=r,e.contHeight=i}else e.contHeight=50},MosaicRandPositioning:function(e,t,a){var H=jQuery("#grsGal"+e.grs).parent().width()*((void 0===e.albumView||void 0!==e.albumView&&e.albumView?parseInt(e.shatts.contwidth):parseInt(e.shatts.galcontwidth))/100),V=0,i=void 0===e.albumView||void 0!==e.albumView&&e.albumView?parseInt(e.shatts.width):parseInt(e.shatts.galwidth),n=e.data.theme.mosaic,F=parseInt(n.mosaicMargin),L="none"!=n.mosaicBorderStyle?2*parseInt(n.mosaicBorderWidth):0,n=2*parseInt(n.mosaicPadding);if(L+=n,!1===e.prevContWidth)e.prevContWidth=H,e.prevLoadedCount=t.loadedCount,e.prevCP=t.currentPage;else if(e.prevContWidth==H){if(e.prevLoadedCount==t.loadedCount&&e.prevCP==t.currentPage)return;e.prevLoadedCount=t.loadedCount,e.prevCP=t.currentPage}else e.prevContWidth=H;if(0!=t.pagedItems[t.currentPage].length){function s(e){for(var t,a=0,i=0,n=[],r=0;r<e.length;r++){for(t=n[r]=0;t<e[r].length;t++)n[r]+=e[r][t].height/e[r][t].width;a+=1/n[r],i+=((e[r].length-1)*F+e[r].length*L)/n[r]}var o,s,g=(H+i-(e.length-1)*F-e.length*L)/a,h=0;for(r=0;r<e.length;r++){for(o=(g-(e[r].length-1)*F-e[r].length*L)/n[r],t=s=0;t<e[r].length;t++)e[r][t].thumbWidth=o,e[r][t].thumbHeight=o*e[r][t].height/e[r][t].width,e[r][t].top=V+s,e[r][t].left=h,s+=e[r][t].thumbHeight+F+L;h+=o+F+L}return g}function g(e){for(var t,a=0,i=0,n=[],r=0;r<e.length;r++){for(t=n[r]=0;t<e[r].length;t++)n[r]+=e[r][t].width/e[r][t].height;a+=1/n[r],i+=((e[r].length-1)*F+e[r].length*L)/n[r]}var o,s,g=H*a-i+(e.length-1)*F+e.length*L,h=0;for(r=0;r<e.length;r++){for(s=(H-(e[r].length-1)*F-e[r].length*L)/n[r],t=o=0;t<e[r].length;t++)e[r][t].thumbHeight=s,e[r][t].thumbWidth=s*e[r][t].width/e[r][t].height,e[r][t].top=V+h,e[r][t].left=o,o+=e[r][t].thumbWidth+F+L;h+=s+F+L}return g}function r(e,t){var a=0;if(1==e.length)a=("ver"==t.groupsInfo[0].gType?s:g)(e[0]);else if(2==e.length){var i="Left"!=t.addMethods[1];if("Bottom"==t.addMethods[1])a=("ver"==t.groupsInfo[0].gType?s:g)(e[0]),V+=a+F,a=("ver"==t.groupsInfo[1].gType?s:g)(e[1]);else if(t.groupsInfo[0].gType==t.groupsInfo[1].gType)"ver"==t.groupsInfo[0].gType?a=function(e,t,a){for(var i,n=0,r=0,o=[],s=0;s<e.length;s++){for(i=o[s]=0;i<e[s].length;i++)o[s]+=e[s][i].height/e[s][i].width;n+=1/o[s],r+=((e[s].length-1)*F+e[s].length*L)/o[s]}var g=0,h=0,l=[];for(s=0;s<t.length;s++){for(i=l[s]=0;i<t[s].length;i++)l[s]+=t[s][i].height/t[s][i].width;g+=1/l[s],h+=((t[s].length-1)*F+t[s].length*L)/l[s]}var p=(H-F+r+h-(e.length+t.length-2)*F-(e.length+t.length)*L)/(n+g),m=p*n-r+(e.length-1)*F+e.length*L,c=p*g-h+(t.length-1)*F+t.length*L,d=0,u=0;a?u=m+F:d=c+F;var f,v,w=0;for(s=0;s<e.length;s++){for(f=(p-(e[s].length-1)*F-e[s].length*L)/o[s],i=v=0;i<e[s].length;i++)e[s][i].thumbWidth=f,e[s][i].thumbHeight=f*e[s][i].height/e[s][i].width,e[s][i].top=V+v,e[s][i].left=d+w,v+=e[s][i].thumbHeight+F+L;w+=f+F+L}for(s=w=0;s<t.length;s++){for(f=(p-(t[s].length-1)*F-t[s].length*L)/l[s],i=v=0;i<t[s].length;i++)t[s][i].thumbWidth=f,t[s][i].thumbHeight=f*t[s][i].height/t[s][i].width,t[s][i].top=V+v,t[s][i].left=u+w,v+=t[s][i].thumbHeight+F+L;w+=f+F+L}return p}(e[0],e[1],i):"hor"==t.groupsInfo[0].gType?a=function(e,t,a){for(var i,n=0,r=0,o=[],s=0;s<e.length;s++){for(i=o[s]=0;i<e[s].length;i++)o[s]+=e[s][i].width/e[s][i].height;n+=1/o[s],r+=((e[s].length-1)*F+e[s].length*L)/o[s]}var g=0,h=0,l=[];for(s=0;s<t.length;s++){for(i=l[s]=0;i<t[s].length;i++)l[s]+=t[s][i].width/t[s][i].height;g+=1/l[s],h+=((t[s].length-1)*F+t[s].length*L)/l[s]}var p=(H-F-r/n-h/g+((e.length-1)/n+(t.length-1)/g)*F+(e.length/n+t.length/g)*L)/(1/n+1/g),m=(p+r-(e.length-1)*F-e.length*L)/n,c=(p+h-(t.length-1)*F-t.length*L)/g,d=0,u=0;a?u=m+F:d=c+F;var f,v,w=0;for(s=0;s<e.length;s++){for(v=(m-(e[s].length-1)*F-e[s].length*L)/o[s],i=f=0;i<e[s].length;i++)e[s][i].thumbHeight=v,e[s][i].thumbWidth=v*e[s][i].width/e[s][i].height,e[s][i].top=V+w,e[s][i].left=d+f,f+=e[s][i].thumbWidth+F+L;w+=v+F+L}for(s=w=0;s<t.length;s++){for(v=(c-(t[s].length-1)*F-t[s].length*L)/l[s],i=f=0;i<t[s].length;i++)t[s][i].thumbHeight=v,t[s][i].thumbWidth=v*t[s][i].width/t[s][i].height,t[s][i].top=V+w,t[s][i].left=u+f,f+=t[s][i].thumbWidth+F+L;w+=v+F+L}return p}(e[0],e[1],i):W.log("LG**Groups have wrong types.");else{if("ver"==t.groupsInfo[0].gType)n=e[0],r=e[1];else{if("hor"!=t.groupsInfo[0].gType)return W.log("LG**Groups have wrong types!!!!!!!!"),a;n=e[1],r=e[0]}a=function(e,t,a){for(var i,n=0,r=0,o=[],s=0;s<e.length;s++){for(i=o[s]=0;i<e[s].length;i++)o[s]+=e[s][i].height/e[s][i].width;n+=1/o[s],r+=((e[s].length-1)*F+e[s].length*L)/o[s]}var g=0,h=0,l=[];for(s=0;s<t.length;s++){for(i=l[s]=0;i<t[s].length;i++)l[s]+=t[s][i].width/t[s][i].height;g+=1/l[s],h+=((t[s].length-1)*F+t[s].length*L)/l[s]}var p=(H-F+r-(e.length-1)*F-e.length*L-(h-(t.length-1)*F-t.length*L)/g)/(n+1/g),m=p*n-r+(e.length-1)*F+e.length*L,c=(p+h-(t.length-1)*F-t.length*L)/g,d=0,u=0;a?u=m+F:d=c+F;var f,v,w=0;for(s=0;s<e.length;s++){for(f=(p-(e[s].length-1)*F-e[s].length*L)/o[s],i=v=0;i<e[s].length;i++)e[s][i].thumbWidth=f,e[s][i].thumbHeight=f*e[s][i].height/e[s][i].width,e[s][i].top=V+v,e[s][i].left=d+w,v+=e[s][i].thumbHeight+F+L;w+=f+F+L}var I,b,C=0;for(s=0;s<t.length;s++){for(I=(c-(t[s].length-1)*F-t[s].length*L)/l[s],i=b=0;i<t[s].length;i++)t[s][i].thumbHeight=I,t[s][i].thumbWidth=I*t[s][i].width/t[s][i].height,t[s][i].top=V+C,t[s][i].left=u+b,b+=t[s][i].thumbWidth+F+L;C+=I+F+L}return p}(n,r,i)}}else if(3==e.length){var n,r,o,i="Right"==t.addMethods[2];if(t.groupsInfo[0].gType==t.groupsInfo[1].gType)"ver"==t.groupsInfo[0].gType?"ver"==t.groupsInfo[2].gType?a=function(e,t,a,i,n){for(var r,o=0,s=0,g=[],h=0;h<e.length;h++){for(r=g[h]=0;r<e[h].length;r++)g[h]+=e[h][r].height/e[h][r].width;o+=1/g[h],s+=((e[h].length-1)*F+e[h].length*L)/g[h]}var l=0,p=0,m=[];for(h=0;h<t.length;h++){for(r=m[h]=0;r<t[h].length;r++)m[h]+=t[h][r].height/t[h][r].width;l+=1/m[h],p+=((t[h].length-1)*F+t[h].length*L)/m[h]}var c=0,d=0,u=[];for(h=0;h<a.length;h++){for(r=u[h]=0;r<a[h].length;r++)u[h]+=a[h][r].height/a[h][r].width;c+=1/u[h],d+=((a[h].length-1)*F+a[h].length*L)/u[h]}var f=(p-s+(e.length-t.length)*(F+L))/l,v=(H-F+s+d-(f+F)*c-(e.length+a.length-2)*F-(e.length+a.length)*L)/(o+c+o*c/l),w=v*o/l+f,I=v+w+F,b=v*o-s+(e.length-1)*F+e.length*L,f=I*c-d+(a.length-1)*F+a.length*L,C=0,y=0;i?y=v+F:C=w+F;var P=0,x=0;n?x=b+F:P=f+F;var S,k,A=0;for(h=0;h<e.length;h++){for(S=(v-(e[h].length-1)*F-e[h].length*L)/g[h],r=k=0;r<e[h].length;r++)e[h][r].thumbWidth=S,e[h][r].thumbHeight=S*e[h][r].height/e[h][r].width,e[h][r].top=V+C+k,e[h][r].left=P+A,k+=e[h][r].thumbHeight+F+L;A+=S+F+L}for(h=A=0;h<t.length;h++){for(S=(w-(t[h].length-1)*F-t[h].length*L)/m[h],r=k=0;r<t[h].length;r++)t[h][r].thumbWidth=S,t[h][r].thumbHeight=S*t[h][r].height/t[h][r].width,t[h][r].top=V+y+k,t[h][r].left=P+A,k+=t[h][r].thumbHeight+F+L;A+=S+F+L}for(h=A=0;h<a.length;h++){for(S=(I-(a[h].length-1)*F-a[h].length*L)/u[h],r=k=0;r<a[h].length;r++)a[h][r].thumbWidth=S,a[h][r].thumbHeight=S*a[h][r].height/a[h][r].width,a[h][r].top=V+k,a[h][r].left=x+A,k+=a[h][r].thumbHeight+F+L;A+=S+F+L}return I}(e[0],e[1],e[2],!0,i):"hor"==t.groupsInfo[2].gType?a=function(e,t,a,i,n){for(var r,o=0,s=0,g=[],h=0;h<e.length;h++){for(r=g[h]=0;r<e[h].length;r++)g[h]+=e[h][r].height/e[h][r].width;o+=1/g[h],s+=((e[h].length-1)*F+e[h].length*L)/g[h]}var l=0,p=0,m=[];for(h=0;h<t.length;h++){for(r=m[h]=0;r<t[h].length;r++)m[h]+=t[h][r].height/t[h][r].width;l+=1/m[h],p+=((t[h].length-1)*F+t[h].length*L)/m[h]}var c=0,d=0,u=[];for(h=0;h<a.length;h++){for(r=u[h]=0;r<a[h].length;r++)u[h]+=a[h][r].width/a[h][r].height;c+=1/u[h],d+=((a[h].length-1)*F+a[h].length*L)/u[h]}var f=(p-s+(e.length-t.length)*(F+L))/l,v=(H-F-(f+d)/c+s+((a.length-2)*F+a.length*L)/c-(e.length-1)*F-e.length*L)/(1/c+o+o/(l*c)),w=v*o/l+f,f=v*o-s+(e.length-1)*F+e.length*L,I=(v+w+d-(a.length-2)*F-a.length*L)/c,b=0,C=0;i?C=v+F:b=w+F;var y=0,P=0;n?P=f+F:y=I+F;var x,S,k=0;for(h=0;h<e.length;h++){for(x=(v-(e[h].length-1)*F-e[h].length*L)/g[h],r=S=0;r<e[h].length;r++)e[h][r].thumbWidth=x,e[h][r].thumbHeight=x*e[h][r].height/e[h][r].width,e[h][r].top=V+b+S,e[h][r].left=y+k,S+=e[h][r].thumbHeight+F+L;k+=x+F+L}for(h=k=0;h<t.length;h++){for(x=(w-(t[h].length-1)*F-t[h].length*L)/m[h],r=S=0;r<t[h].length;r++)t[h][r].thumbWidth=x,t[h][r].thumbHeight=x*t[h][r].height/t[h][r].width,t[h][r].top=V+C+S,t[h][r].left=y+k,S+=t[h][r].thumbHeight+F+L;k+=x+F+L}var A,T,E=0;for(h=0;h<a.length;h++){for(A=(I-(a[h].length-1)*F-a[h].length*L)/u[h],r=T=0;r<a[h].length;r++)a[h][r].thumbHeight=A,a[h][r].thumbWidth=A*a[h][r].width/a[h][r].height,a[h][r].top=V+E,a[h][r].left=P+T,T+=a[h][r].thumbWidth+F+L;E+=A+F+L}return v+w+F}(e[0],e[1],e[2],!0,i):W.log("LG**Groups have wrong types!!!!!!!!"):"hor"==t.groupsInfo[0].gType?"ver"==t.groupsInfo[2].gType?a=function(e,t,a,i,n){for(var r,o=0,s=0,g=[],h=0;h<e.length;h++){for(r=g[h]=0;r<e[h].length;r++)g[h]+=e[h][r].width/e[h][r].height;o+=1/g[h],s+=((e[h].length-1)*F+e[h].length*L)/g[h]}var l=0,p=0,m=[];for(h=0;h<t.length;h++){for(r=m[h]=0;r<t[h].length;r++)m[h]+=t[h][r].width/t[h][r].height;l+=1/m[h],p+=((t[h].length-1)*F+t[h].length*L)/m[h]}var c=0,d=0,u=[];for(h=0;h<a.length;h++){for(r=u[h]=0;r<a[h].length;r++)u[h]+=a[h][r].height/a[h][r].width;c+=1/u[h],d+=((a[h].length-1)*F+a[h].length*L)/u[h]}var f=(s-(e.length-1)*F-e.length*L)/o,v=(p-(t.length-1)*F-t.length*L)/l,w=(H-F-(f-v)*l*c-c*F+d-f-(a.length-1)*F-a.length*L)/(1/o+c+l*c/o),v=w*l/o+(f-v)*l,I=w+v+F,b=w/o+f,f=I*c-d+(a.length-1)*F+a.length*L,C=0,y=0;i?y=w+F:C=v+F;var P=0,x=0;n?x=b+F:P=f+F;var S,k,A=0;for(h=0;h<e.length;h++){for(S=(b-(e[h].length-1)*F-e[h].length*L)/g[h],r=k=0;r<e[h].length;r++)e[h][r].thumbHeight=S,e[h][r].thumbWidth=S*e[h][r].width/e[h][r].height,e[h][r].top=V+C+A,e[h][r].left=P+k,k+=e[h][r].thumbWidth+F+L;A+=S+F+L}for(h=A=0;h<t.length;h++){for(S=(b-(t[h].length-1)*F-t[h].length*L)/m[h],r=k=0;r<t[h].length;r++)t[h][r].thumbHeight=S,t[h][r].thumbWidth=S*t[h][r].width/t[h][r].height,t[h][r].top=V+y+A,t[h][r].left=P+k,k+=t[h][r].thumbWidth+F+L;A+=S+F+L}var T,E,M=0;for(h=0;h<a.length;h++){for(T=(I-(a[h].length-1)*F-a[h].length*L)/u[h],r=E=0;r<a[h].length;r++)a[h][r].thumbWidth=T,a[h][r].thumbHeight=T*a[h][r].height/a[h][r].width,a[h][r].top=V+E,a[h][r].left=x+M,E+=a[h][r].thumbHeight+F+L;M+=T+F+L}return I}(e[0],e[1],e[2],!0,i):"hor"==t.groupsInfo[2].gType?a=function(e,t,a,i,n){for(var r,o=0,s=0,g=[],h=0;h<e.length;h++){for(r=g[h]=0;r<e[h].length;r++)g[h]+=e[h][r].width/e[h][r].height;o+=1/g[h],s+=((e[h].length-1)*F+e[h].length*L)/g[h]}var l=0,p=0,m=[];for(h=0;h<t.length;h++){for(r=m[h]=0;r<t[h].length;r++)m[h]+=t[h][r].width/t[h][r].height;l+=1/m[h],p+=((t[h].length-1)*F+t[h].length*L)/m[h]}var c=0,d=0,u=[];for(h=0;h<a.length;h++){for(r=u[h]=0;r<a[h].length;r++)u[h]+=a[h][r].width/a[h][r].height;c+=1/u[h],d+=((a[h].length-1)*F+a[h].length*L)/u[h]}var f=(s-(e.length-1)*F-e.length*L)/o,v=(p-(t.length-1)*F-t.length*L)/l,w=(d-(a.length-2)*F-a.length*L)/c,I=(H-F-f-w-(f-v)*l/c)/(1/o+1/c+l/(c*o)),b=I*l/o+(f-v)*l,v=I+b+F,C=I/o+f,y=(I+b)/c+w,P=0,x=0;i?x=I+F:P=b+F;var S=0,k=0;n?k=C+F:S=y+F;var A,T,E=0;for(h=0;h<e.length;h++){for(A=(C-(e[h].length-1)*F-e[h].length*L)/g[h],r=T=0;r<e[h].length;r++)e[h][r].thumbHeight=A,e[h][r].thumbWidth=A*e[h][r].width/e[h][r].height,e[h][r].top=V+P+E,e[h][r].left=S+T,T+=e[h][r].thumbWidth+F+L;E+=A+F+L}for(h=E=0;h<t.length;h++){for(A=(C-(t[h].length-1)*F-t[h].length*L)/m[h],r=T=0;r<t[h].length;r++)t[h][r].thumbHeight=A,t[h][r].thumbWidth=A*t[h][r].width/t[h][r].height,t[h][r].top=V+x+E,t[h][r].left=S+T,T+=t[h][r].thumbWidth+F+L;E+=A+F+L}for(h=E=0;h<a.length;h++){for(A=(y-(a[h].length-1)*F-a[h].length*L)/u[h],r=T=0;r<a[h].length;r++)a[h][r].thumbHeight=A,a[h][r].thumbWidth=A*a[h][r].width/a[h][r].height,a[h][r].top=V+E,a[h][r].left=k+T,T+=a[h][r].thumbWidth+F+L;E+=A+F+L}return v}(e[0],e[1],e[2],!0,i):W.log("LG**Groups have wrong types!!!!!!!!"):W.log("LG**Groups have wrong types!!!!!!!!");else{if("ver"==t.groupsInfo[0].gType&&"hor"==t.groupsInfo[1].gType)n=e[0],r=e[1],o=!0;else{if("hor"!=t.groupsInfo[0].gType||"ver"!=t.groupsInfo[1].gType)return W.log("LG**Groups have wrong types!!!!!!!!"),a;n=e[1],r=e[0],o=!1}"ver"==t.groupsInfo[2].gType?a=function(e,t,a,i,n){for(var r,o=0,s=0,g=[],h=0;h<e.length;h++){for(r=g[h]=0;r<e[h].length;r++)g[h]+=e[h][r].height/e[h][r].width;o+=1/g[h],s+=((e[h].length-1)*F+e[h].length*L)/g[h]}var l=0,p=0,m=[];for(h=0;h<t.length;h++){for(r=m[h]=0;r<t[h].length;r++)m[h]+=t[h][r].width/t[h][r].height;l+=1/m[h],p+=((t[h].length-1)*F+t[h].length*L)/m[h]}var c=0,d=0,u=[];for(h=0;h<a.length;h++){for(r=u[h]=0;r<a[h].length;r++)u[h]+=a[h][r].height/a[h][r].width;c+=1/u[h],d+=((a[h].length-1)*F+a[h].length*L)/u[h]}var f=(H-F+s-(e.length-1)*F-e.length*L-c*F+d-(a.length-1)*F-a.length*L)*c/(o+c),v=(H-F-f+((t.length-1)*F+t.length*L-p)/l-c*F+d-(a.length-1)*F-a.length*L)/(1/l+c-c*c/(o+c)),w=(f-v*c*c/(o+c))/c,I=w+v+F,b=w*o-s+(e.length-1)*F+e.length*L,f=I*c-d+(a.length-1)*F+a.length*L,C=0,y=0;i?y=w+F:C=v+F;var P=0,x=0;n?x=b+F:P=f+F;var S,k,A=0;for(h=0;h<e.length;h++){for(S=(w-(e[h].length-1)*F-e[h].length*L)/g[h],r=k=0;r<e[h].length;r++)e[h][r].thumbWidth=S,e[h][r].thumbHeight=S*e[h][r].height/e[h][r].width,e[h][r].top=V+C+k,e[h][r].left=P+A,k+=e[h][r].thumbHeight+F+L;A+=S+F+L}var T,E,M=0;for(h=0;h<t.length;h++){for(T=(b-(t[h].length-1)*F-t[h].length*L)/m[h],r=E=0;r<t[h].length;r++)t[h][r].thumbHeight=T,t[h][r].thumbWidth=T*t[h][r].width/t[h][r].height,t[h][r].top=V+y+M,t[h][r].left=P+E,E+=t[h][r].thumbWidth+F+L;M+=T+F+L}for(h=A=0;h<a.length;h++){for(S=(I-(a[h].length-1)*F-a[h].length*L)/u[h],r=k=0;r<a[h].length;r++)a[h][r].thumbWidth=S,a[h][r].thumbHeight=S*a[h][r].height/a[h][r].width,a[h][r].top=V+k,a[h][r].left=x+A,k+=a[h][r].thumbHeight+F+L;A+=S+F+L}return I}(n,r,e[2],o,i):"hor"==t.groupsInfo[2].gType?a=function(e,t,a,i,n){for(var r,o=0,s=0,g=[],h=0;h<e.length;h++){for(r=g[h]=0;r<e[h].length;r++)g[h]+=e[h][r].height/e[h][r].width;o+=1/g[h],s+=((e[h].length-1)*F+e[h].length*L)/g[h]}var l=0,p=0,m=[];for(h=0;h<t.length;h++){for(r=m[h]=0;r<t[h].length;r++)m[h]+=t[h][r].width/t[h][r].height;l+=1/m[h],p+=((t[h].length-1)*F+t[h].length*L)/m[h]}var c=0,d=0,u=[];for(h=0;h<a.length;h++){for(r=u[h]=0;r<a[h].length;r++)u[h]+=a[h][r].width/a[h][r].height;c+=1/u[h],d+=((a[h].length-1)*F+a[h].length*L)/u[h]}var f=l*((e.length-1)*F+e.length*L-s)-p+(t.length-1)*F+t.length*L,v=(H-F+s-(e.length-1)*F-e.length*L-(f+d-(a.length-2)*F-a.length*L)/c)/(o+1/c+o*l/c),w=v*o*l+f,f=v+w+F,I=v*o-s+(e.length-1)*F+e.length*L,b=(f+d-(a.length-1)*F-a.length*L)/c,C=0,y=0;i?y=v+F:C=w+F;var P=0,x=0;n?x=I+F:P=b+F;var S,k,A=0;for(h=0;h<e.length;h++){for(S=(v-(e[h].length-1)*F-e[h].length*L)/g[h],r=k=0;r<e[h].length;r++)e[h][r].thumbWidth=S,e[h][r].thumbHeight=S*e[h][r].height/e[h][r].width,e[h][r].top=V+C+k,e[h][r].left=P+A,k+=e[h][r].thumbHeight+F+L;A+=S+F+L}var T,E,M=0;for(h=0;h<t.length;h++){for(T=(I-(t[h].length-1)*F-t[h].length*L)/m[h],r=E=0;r<t[h].length;r++)t[h][r].thumbHeight=T,t[h][r].thumbWidth=T*t[h][r].width/t[h][r].height,t[h][r].top=V+y+M,t[h][r].left=P+E,E+=t[h][r].thumbWidth+F+L;M+=T+F+L}for(h=M=0;h<a.length;h++){for(T=(b-(a[h].length-1)*F-a[h].length*L)/u[h],r=E=0;r<a[h].length;r++)a[h][r].thumbHeight=T,a[h][r].thumbWidth=T*a[h][r].width/a[h][r].height,a[h][r].top=V+M,a[h][r].left=x+E,E+=a[h][r].thumbWidth+F+L;M+=T+F+L}return f}(n,r,e[2],o,i):W.log("LG**Groups have wrong types!!!!!!!!")}}else W.log("LG**Wrong groups count!!!!!!!!");return a}for(var o,h,l,p,m,c,d,u,f,v={Top:function(e,t,a,i){a.width=parseInt(a.width),a.height=parseInt(a.height),a.thumbWidth=(0<t.currentLength?t:a).width,a.thumbHeight=a.height*a.thumbWidth/a.width;var n=t.width,r=t.height;0==t.currentLength&&(n=a.thumbWidth),r+=a.thumbHeight,1<h&&n/r<=I&&!i?this.Right(e,t,a,!0):(t.width=n,t.height=r,a.addedFrom="Top",0==t.currentLength?(e.push([a]),t.gType="ver"):1!=t.currentLength&&("Right"==t.addMethods[t.addMethods.length-1]||"Left"==t.addMethods[t.addMethods.length-1])?(e.splice(0,0,[a]),t.gType="hor"):(e[0].splice(0,0,a),t.gType="ver"),t.currentLength++,t.addMethods.push("Top"))},Right:function(e,t,a,i){a.width=parseInt(a.width),a.height=parseInt(a.height),a.thumbHeight=(0<t.currentLength?t:a).height,a.thumbWidth=a.width*a.thumbHeight/a.height;var n=t.width,r=t.height;0==t.currentLength&&(r=a.thumbHeight),n+=a.thumbWidth,1<h&&b<=n/r&&!i?this.Bottom(e,t,a,!0):(t.width=n,t.height=r,a.addedFrom="Right",0==t.currentLength?(e.push([a]),t.gType="hor"):1!=t.currentLength&&("Top"==t.addMethods[t.addMethods.length-1]||"Bottom"==t.addMethods[t.addMethods.length-1])?(e.push([a]),t.gType="ver"):(e[0].push(a),t.gType="hor"),t.currentLength++,t.addMethods.push("Right"))},Bottom:function(e,t,a,i){a.width=parseInt(a.width),a.height=parseInt(a.height),a.thumbWidth=(0<t.currentLength?t:a).width,a.thumbHeight=a.height*a.thumbWidth/a.width;var n=t.width,r=t.height;0==t.currentLength&&(n=a.thumbWidth),r+=a.thumbHeight,1<h&&n/r<=I&&!i?this.Right(e,t,a,!0):(t.width=n,t.height=r,a.addedFrom="Bottom",0==t.currentLength?(e.push([a]),t.gType="ver"):1!=t.currentLength&&("Right"==t.addMethods[t.addMethods.length-1]||"Left"==t.addMethods[t.addMethods.length-1])?(e.push([a]),t.gType="hor"):(e[0].push(a),t.gType="ver"),t.currentLength++,t.addMethods.push("Bottom"))},Left:function(e,t,a,i){a.width=parseInt(a.width),a.height=parseInt(a.height),a.thumbHeight=(0<t.currentLength?t:a).height,a.thumbWidth=a.width*a.thumbHeight/a.height;var n=t.width,r=t.height;0==t.currentLength&&(r=a.thumbHeight),n+=a.thumbWidth,1<h&&b<=n/r&&!i?this.Bottom(e,t,a,!0):(t.width=n,t.height=r,a.addedFrom="Left",0==t.currentLength?(e.push([a]),t.gType="hor"):1!=t.currentLength&&("Top"==t.addMethods[t.addMethods.length-1]||"Bottom"==t.addMethods[t.addMethods.length-1])?(e.splice(0,0,[a]),t.gType="ver"):(e[0].splice(0,0,a),t.gType="hor"),t.currentLength++,t.addMethods.push("Left"))}},w={Right:function(e,t,a,i){e.length<1?(t.width=a.width,t.height=a.height):t.width+=a.width*t.height/a.height,e.push(i),t.addMethods.push("Right"),t.groupsInfo.push(a)},Bottom:function(e,t,a,i){e.length<1?(t.width=a.width,t.height=a.height):t.height+=a.height*t.width/a.width,e.push(i),t.addMethods.push("Bottom"),t.groupsInfo.push(a)},Left:function(e,t,a,i){e.length<1?(t.width=a.width,t.height=a.height):t.width+=a.width*t.height/a.height,e.push(i),t.addMethods.push("Left"),t.groupsInfo.push(a)}},I=.6,b=1.8,C=["Top","Right","Bottom","Left"],y=H-L<=i?(h=1,C=["Bottom"],o=t.pagedItems[t.currentPage].length,1):(H-3*F-4*L)/4<=i?(o=h=2,0):(H-4*F-5*L)/5<=i?(h=3,o=2,1):(h=4,o=3,0),P=[],x=[],S=[],k=0;k<t.pagedItems[t.currentPage].length;k++)0==P.length&&(k+(u=o+Math.round(Math.random()*y))==t.pagedItems[t.currentPage].length-1&&(u=2<u?u-1:u+1),l={width:0,height:0,currentLength:0,gType:"none",addMethods:[]}),p=(d=t.pagedItems[t.currentPage][k]).width/d.height,m=l.width/l.height,f=!0,1<h&&(p<=I||m<=I)?c=Math.random()<=.5?"Right":"Left":1<h&&(b<=p||b<=m)?c=Math.random()<=.5?"Bottom":"Top":(c=C[Math.round(Math.random()*(C.length-1))],f=!1),v[c](P,l,d,f),l.currentLength!=u&&k+1!=t.pagedItems[t.currentPage].length||(x.push(P),P=[],S.push(l));var A,T,E=[],M=[],$=[],G="";for(k=0;k<x.length;k++)0==E.length&&(A={width:0,height:0,needLength:2,isSpecGroup:!1,addMethods:[],groupsInfo:[]},2<h&&x.length-k<=4&&(A.needLength=x.length-k==4?2:x.length-k,A.isSpecGroup=!0)),d=x[k],itemInfo=S[k],Math.round(Math.random()*(C.length-1)),p=itemInfo.width/itemInfo.height,m=A.width/A.height,w[c=""!=G?G:1<h&&b<=p&&b<=m?"Bottom":Math.random()<=.5?"Right":"Left"](E,A,itemInfo,d),A.isSpecGroup?G=A.needLength-E.length==2?"Bottom":A.needLength-E.length==1?Math.random()<=.5?"Right":"Left":"":2<h&&"Bottom"==c&&k+1<x.length&&S[k+1].width/S[k+1].height<b?(G=Math.random()<=.5?"Right":"Left",A.needLength++):G="",(E.length>=A.needLength||k+1>=x.length)&&(M.push(E),E=[],$.push(A));for(k=0;k<M.length;k++)T=r(M[k],$[k]),V+=T+F;e.contWidth=H,e.contHeight=0<V?V-F:0}else e.contHeight=50}}}]);